(()=>{var __webpack_modules__={349:(t,e,n)=>{"use strict";n.d(e,{SH:()=>i,ZP:()=>r,Fy:()=>o,bE:()=>a,OK:()=>s,ZA:()=>u,io:()=>p,ax:()=>h});var i=192,r=224,o=360,a=240;function s(t){return t/o}function u(t){return t/a}var c=1/64;function p(t){t.rect([-i,-r,2*i,2*r],c)}function h(t){var e=function(e){return t.rect(e,c)};e([-i,a-16,2*i,16]),e([-i,-a,2*i,16]),e([-o,-a,o-i,2*a]),e([i,-a,o-i,2*a])}},780:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{l:()=>GLHelper});var _gl__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(924),_Screen__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(349),__spreadArrays=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i},GLHelper=function(){function GLHelper(){this.ver=[],this.tex=[],this.alp=[],this.n=0}return GLHelper.prototype.bind=function(t){this.img=t},GLHelper.prototype.rect=function(t,e){var n,i,r=t[0],o=t[1],a=t[2],s=t[3],u=[r,o,r,o+s,r+a,o,r,o+s,r+a,o,r+a,o+s];(n=this.ver).push.apply(n,u),(i=this.tex).push.apply(i,u.map((function(t){return t*e}))),this.alp.push(1,1,1,1,1,1),this.n+=6},GLHelper.prototype.fan=function(_a,n){for(var _b,_c,da=_a[0],oa=_a[1],ox=_a[2],oy=_a[3],or=_a[4],ta=_a[5],tx=_a[6],ty=_a[7],trw=_a[8],trh=_a[9],alpha=_a[10],num=Math.ceil(Math.abs(da)/(2*Math.PI)*n),f0=function(t,e,n,i,r){return[t+n*Math.cos(r),e+i*Math.sin(r)]},f1=function(t,e,n,i,r,o){return __spreadArrays(f0(t,e,0,0,0),f0(t,e,n,i,r),f0(t,e,n,i,o))},i=0;i<num;i++)(_b=this.ver).push.apply(_b,f1(ox,oy,or,or,oa+da/num*i,oa+da/num*(i+1))),(_c=this.tex).push.apply(_c,f1(tx,ty,trw,trh,ta+da/num*i,ta+da/num*(i+1))),this.alp.push(alpha,alpha,alpha);this.n+=3*num,eval("window.debug_info.fver = this.ver")},GLHelper.prototype.flush=function(){for(var t=new Float32Array(this.ver),e=0;e<t.length;e+=2)t[e]=(0,_Screen__WEBPACK_IMPORTED_MODULE_1__.OK)(t[e]),t[e+1]=(0,_Screen__WEBPACK_IMPORTED_MODULE_1__.ZA)(t[e+1]);_gl__WEBPACK_IMPORTED_MODULE_0__.draw(t,new Float32Array(this.tex),new Float32Array(this.alp),this.img,this.n),this.ver=[],this.tex=[],this.alp=[],this.n=0},GLHelper}()},85:(t,e,n)=>{"use strict";n.d(e,{p:()=>st,K:()=>ut});var i={};n.r(i),n.d(i,{ability_invinc:()=>M,ability_slow:()=>m,ability_small:()=>I,ability_stop:()=>g});var r={};n.r(r),n.d(r,{stage_000:()=>Y,stage_001:()=>Z,stage_002:()=>X,stage_003:()=>tt,stage_004:()=>et,stage_005:()=>nt,stage_006:()=>rt,test_000:()=>ot,test_001:()=>at});var o,a=n(822),s=n(924),u=n(780),c=n(940),p=n(583),h=n(68),l=n(869),_=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i},f=p.xg(c.cI,1),d=function(){function t(t){this.special_duration=t,this.special_remain=0}return t.prototype.updateEnable=function(t,e){return this.special_remain>0&&this.update(t),!(this.special_remain>0||!(e&&t.ability_count>0&&this.onActivate(t))||(t.ability_count--,this.special_remain=this.special_duration,1))},t.prototype.render=function(t,e){if(t==l.t4+50){var n=new u.l;s.setMode(0);var i=f.sprite,r=[(i.tx+i.tw/2)/i.sprite.w,(i.ty+i.th/2)/i.sprite.h,i.tw/2/i.sprite.w,i.th/2/i.sprite.h];if(n.bind(h.Z.get(i.sprite.path).img),0==this.special_remain){var o=2*Math.PI*e.ability_count/(e.ability.max_ability+1),a=2*Math.PI*(e.graze_current/e.ability.max_graze)/(e.ability.max_ability+1),c=e.post_grazed?.7:.5,p=e.graze_current==e.ability.max_graze?c:e.post_grazed?.7:.2;n.fan(_([o,Math.PI/2,e.px,e.py,f.w/2,Math.PI/6],r,[c]),32),n.fan(_([a,Math.PI/2+o,e.px,e.py,f.w/2,Math.PI/6+o],r,[p]),32)}else o=2*Math.PI*this.special_remain/this.special_duration,n.fan(_([o,-o+Math.PI/2,e.px,e.py,f.w/2,-o+Math.PI/6],r,[1]),32);n.flush()}},t.prototype.layers=function(){return[l.t4+50]},t}(),y=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),v=function(t){function e(){return t.call(this,240)||this}return y(e,t),e.prototype.update=function(){this.special_remain--},e.prototype.onActivate=function(){return!(a.n.INSTANCE.special_effects.list.length>0||(a.n.INSTANCE.special_effects.time_slowdown(.5,240),0))},e}(d),m={name:"slow",init:function(){return new v}},w=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),b=function(t){function e(){return t.call(this,120)||this}return w(e,t),e.prototype.update=function(){this.special_remain--},e.prototype.onActivate=function(){return!(a.n.INSTANCE.special_effects.list.length>0||(a.n.INSTANCE.special_effects.time_slowdown(0,120),0))},e}(d),g={name:"stop",init:function(){return new b}},x=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),E=function(t){function e(){return t.call(this,30)||this}return x(e,t),e.prototype.update=function(t){this.special_remain-=a.n.INSTANCE.special_effects.time_rate,t.magn=this.special_remain>0?-1/0:1},e.prototype.onActivate=function(){return!0},e}(d),M={name:"invincibility",init:function(){return new E}},A=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),T=function(t){function e(){return t.call(this,300)||this}return A(e,t),e.prototype.update=function(t){this.special_remain-=a.n.INSTANCE.special_effects.time_rate,t.magn=this.special_remain>0?0:1},e.prototype.onActivate=function(){return!0},e}(d),I={name:"small hitbox",init:function(){return new T}},P=n(349),S=n(566),R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),O={render_layer:l.bm,collide_group:l.A4,collide_mask:l.A4,kill_on_exit:!0,kill_by:function(t){return t==l.t_||t==l.T},auto_direction:!0,life:0,listener:null},N=function(t,e){return!0},k=function(t){function e(e,n){var i=t.call(this,e)||this;return i.state=0,i.motion=N,i.custom_fields={},i.config=n,i.time=0,i}return R(e,t),e.prototype.setMotion=function(t){return this.motion=t,this.simpleInit(0,0,0,0)},e.prototype.simpleInit=function(t,e,n,i){return this.px=t,this.py=e,this.vx=n*Math.cos(i),this.vy=n*Math.sin(i),this.dir=i,this.motion(this,0)&&this.config.auto_direction&&(this.dir=Math.atan2(this.vy,this.vx)),this},e.prototype.init=function(t){return t(this),this},e.prototype.update=function(t){var e,n,i,r,o,s,u,c,p=this;0==this.state&&(this.state=1,null===(n=null===(e=this.config.listener)||void 0===e?void 0:e.onInit)||void 0===n||n.forEach((function(t){return t(p)})));var h=a.n.INSTANCE.special_effects.time_rate;this.time+=h,null===(r=null===(i=this.config.listener)||void 0===i?void 0:i.onUpdate)||void 0===r||r.forEach((function(t){return t(p,h)})),this.motion(this,h)&&(this.px+=this.vx*h,this.py+=this.vy*h,this.config.auto_direction&&(this.dir=Math.atan2(this.vy,this.vx))),(null===(s=null===(o=this.shaped_sprite)||void 0===o?void 0:o.sprite)||void 0===s?void 0:s.omega)&&(this.dir=this.time*this.shaped_sprite.sprite.omega),null===(c=null===(u=this.config.listener)||void 0===u?void 0:u.onPostMotion)||void 0===c||c.forEach((function(t){return t(p,h)}))},e.prototype.postUpdate=function(t){var e,n,i,r,o,a,s,u,c=this,p=null===(n=null===(e=this.shaped_sprite)||void 0===e?void 0:e.shape)||void 0===n?void 0:n.exitScreen(this),h=this.px>P.SH+p,l=-this.px>P.SH+p,_=this.py>P.ZP+p,f=-this.py>P.ZP+p;this.motion||(h&&(h=this.vx>0),l&&(l=this.vx<0),_&&(_=this.vy>0),f&&(f=this.vy<0)),(h||l||_||f)&&this.config.kill_on_exit&&(this.state=2,null===(r=null===(i=this.config.listener)||void 0===i?void 0:i.onExitScreen)||void 0===r||r.forEach((function(t){return t(c)}))),this.config.life&&this.time>=this.config.life&&(this.state=2),null===(a=null===(o=this.config.listener)||void 0===o?void 0:o.onPostUpdate)||void 0===a||a.forEach((function(t){return t(c)})),2==this.state&&(null===(u=null===(s=this.config.listener)||void 0===s?void 0:s.onDestroy)||void 0===u||u.forEach((function(t){return t(c)})),this.state=3)},e.prototype.attack=function(t,e){var n,i,r=this;null===(i=null===(n=this.config.listener)||void 0===n?void 0:n.onAttack)||void 0===i||i.forEach((function(t){return t(r,e)})),e.damaged(e,this)},e.prototype.damaged=function(t,e){var n,i,r=this;return!!this.config.kill_by(e.config.collide_group)&&(this.state=2,null===(i=null===(n=this.config.listener)||void 0===n?void 0:n.onKill)||void 0===i||i.forEach((function(t){return t(r,e)})),!0)},e}(S.eY),D=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),C=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i},U=function(){},F=function(t){function e(e){var n=t.call(this)||this;return n.remain=e,n}return D(e,t),e.prototype.update=function(t){return this.remain-=t,this.remain<0?-this.remain:0},e}(U),B=function(t){function e(e){var n=t.call(this)||this;return n.time=0,n.init=e,n}return D(e,t),e.random=function(t,n){return function(){return new e((function(e){var i=Math.max(n.px0-t.px,-n.dx1),r=Math.min(n.px1-t.px,n.dx1),o=Math.max(n.py0-t.py,-n.dy1),a=Math.min(n.py1-t.py,n.dy1),s=i+Math.random()*(r-i),u=o+Math.random()*(a-o);e.target=t,e.duration=n.duration,e.dx=s,e.dy=u,e.x0=t.px,e.y0=t.py,e.ease=n.ease}))}},e.prototype.update=function(t){0==this.time&&this.init(this),this.time+=t;var e=Math.min(1,this.time/this.duration),n=this.ease(e);return this.target.px=this.x0+this.dx*n,this.target.py=this.y0+this.dy*n,this.time>this.duration?this.time-this.duration:0},e}(U),L=function(t){function e(e){var n=t.call(this)||this;return n.todo=e,n}return D(e,t),e.prototype.update=function(t,e){var n=this.todo();return void 0===n?t:"number"==typeof n?(e.list[0]=new F(n),e.list[0].update(t,e)):(e.list.unshift(e.list[0]),e.list[1]=n,t)},e}(U),q=function(){};function H(t){return t.map((function(t){return"number"==typeof t?new F(t):"function"==typeof t?new L(t):t}))}var W=function(t){function e(e,n){var i=t.call(this)||this;return i.index=0,i.todo=e,i.total=n,i}return D(e,t),e.prototype.supply=function(){return this.index>=this.total?null:(t="function"==typeof this.todo?this.todo(this.index):this.todo,this.index++,H(t));var t},e}(q),K={render_layer:l.NH,collide_group:l.T7,collide_mask:l.Io},j=function(t){function e(e){var n=t.call(this)||this;return n.custom_fields={},n.config=K,n.state=0,n.time=0,n.list=H("object"==typeof e?e:e(n)),n}return D(e,t),e.prototype.init=function(t){return t(this),this},e.prototype.update=function(t){0==this.state&&(this.state=1);var e=a.n.INSTANCE.special_effects.time_rate;for(this.time+=e;this.list.length>0&&e;){var n=this.list[0];if(n instanceof q){var i=n.supply();i&&i.length?this.list=C(i,this.list):this.list.shift()}else(e=n.update(e,this))>0&&this.list.shift()}0==this.list.length&&(this.state=2)},e.prototype.postUpdate=function(t){2==this.state&&(this.state=3)},e.prototype.attack=function(t){},e.prototype.damaged=function(t,e){return!1},e}(S.u5),z=function(t,e){return void 0===e&&(e=1/0),function(){return new W(t,e)}},G=function(t){return function(){return a.n.INSTANCE.add(new j(t))}},Y={name:"波与粒的境界",default_scale:3,init:function(t){var e=c.hZ(5,1,0),n=p.xg(e,1);return new j([30*t,z((function(e){return[z((function(i){return[function(){return a.n.INSTANCE.add(new k(n,O).simpleInit(0,0,8/t,.003/t*e*e+2*Math.PI/5*i))}]}),5),1*t]}),1/0)])}},Z={name:"龙纹弹",default_scale:3,init:function(t){var e=function(t){return p.xg(c.e8(1,t,0),1)},n=(0,l.d9)(O);n.life=180*t,n.kill_on_exit=!1;var i={duration:100*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},r=1*t,o=3/t,s=-o/70,u=.06/t,h=new k(p.xg(c.cI,2),O).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),_=null,f=function(t,e,i,c){return a.n.INSTANCE.add(new j([z((function(p){return[function(){return a.n.INSTANCE.add(_=new k(null,n).simpleInit(h.px,h.py,o,2*Math.PI/47*p*e*t))},z((function(e){return[function(){return a.n.INSTANCE.add(new k(p%2==0?i:c,O).setMotion((n=_,r=2*Math.PI/30*e,o=u*t,70,h=s,function(t,e){var i=r+o*t.time,a=70*Math.sin(h*t.time);return t.px=n.px+a*Math.cos(i),t.py=n.py+a*Math.sin(i),t.dir=Math.atan2(a*o,70*h*Math.cos(h*t.time))+i,!1})));var n,r,o,h}]}),30),r]}),47)]))};return new j([function(){return a.n.INSTANCE.add(h)},30*t,z((function(n){return[function(){return f(n%2*2-1,7,e(2),e(10))},50*t,function(){return f(n%2*2-1,5,e(13),e(6))},50*t,function(){return f(n%2*2-1,1,e(8),e(4))},B.random(h,i)]}))])}},X={name:"rotating long bullet",default_scale:3,init:function(t){var e=p.p3(2,0,64),n=(0,l.d9)(O);n.auto_direction=!1;var i={duration:50*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},r=new k(p.xg(c.cI,2),O).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),o=function(t){return z((function(i){return[function(){return a.n.INSTANCE.add(new k(e,n).setMotion((function(e,n){return e.dir+=n*t,!0})).simpleInit(r.px,r.py,_,f+2*Math.PI/s*i).init((function(t){return t.dir+=2*Math.PI*u/s*i})))}]}),s)},s=50,u=2.5,h=2*Math.PI/60/t,_=6/t,f=0;return new j([function(){return a.n.INSTANCE.add(r)},30*t,z((function(e){return[function(){return f=Math.random()*Math.PI*2},o(h),20*t,o(-h),B.random(r,i)]}))])}},V=n(296),$={w0:-P.SH,w1:P.SH,h0:-P.ZP,h1:P.ZP,max:1/0,inner_bound:!0,outer_bound:!1},J=function(t){return function(e){e.onInit.push((function(e){var n=e.custom_fields;n.in_screen=e.px>t.w0&&e.px<t.w1&&e.py>t.h0&&e.py<t.h1,n.ref_count=0})),e.onPostMotion.push((function(e,n){var i=e.custom_fields,r=i.in_screen;i.in_screen=e.px>t.w0&&e.px<t.w1&&e.py>t.h0&&e.py<t.h1,r&&!i.in_screen&&t.inner_bound&&(i.ref_count<t.max&&e.px<=t.w0&&(i.ref_count++,e.vx=-e.vx,e.px=2*t.w0-e.px),i.ref_count<t.max&&e.px>=t.w1&&(i.ref_count++,e.vx=-e.vx,e.px=2*t.w1-e.px),i.ref_count<t.max&&e.py<=t.h0&&(i.ref_count++,e.vy=-e.vy,e.py=2*t.h0-e.py),i.ref_count<t.max&&e.py>=t.h1&&(i.ref_count++,e.vy=-e.vy,e.py=2*t.h1-e.py),e.dir=Math.atan2(e.vy,e.vx),i.in_screen=!0),!r&&i.in_screen&&t.outer_bound&&(i.ref_count<t.max&&e.px>=t.w0&&(i.ref_count++,e.vx=-e.vx,e.px=2*t.w0-e.px),i.ref_count<t.max&&e.px<=t.w1&&(i.ref_count++,e.vx=-e.vx,e.px=2*t.w1-e.px),i.ref_count<t.max&&e.py>=t.h0&&(i.ref_count++,e.vy=-e.vy,e.py=2*t.h0-e.py),i.ref_count<t.max&&e.py<=t.h1&&(i.ref_count++,e.vy=-e.vy,e.py=2*t.h1-e.py),e.dir=Math.atan2(e.vy,e.vx),i.in_screen=!1)}))}},Q={name:"",w0:-P.SH,w1:P.SH,h0:-P.ZP,h1:P.ZP,max:1/0,maxlen:NaN,v:NaN,body:null,cf:null},tt={name:"reflect and delayed altering",default_scale:3,init:function(t){var e=p.xg(c.e8(4,2,0),1),n=(0,l.d9)(O);n.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]};var i=(0,l.d9)($);i.max=100,J(i)(n.listener);var r=Math.PI/24,o=6/t,s=100*t,u=1*t,h=1*t,_={duration:s-40*h-20*u,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},f=new k(p.xg(c.cI,2),O).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),d=0;return new j([function(){return a.n.INSTANCE.add(f)},30*t,z((function(t){return[function(){return d=Math.random()*Math.PI*2},z((function(t){return[G([z((function(){return[function(){return a.n.INSTANCE.add(new k(e,n).setMotion((function(e,n){var a,u=s-t*h;return e.time-n<u&&e.time>=u&&((a=i,function(t){return t.custom_fields.ref_count=a.max})(e),e.simpleInit(e.px,e.py,o,e.dir+(2*Math.random()-1)*r)),!0})).simpleInit(f.px,f.py,o,d+2*Math.PI/40*t))},u]}),20)]),h]}),40),20*u,B.random(f,_)]}))])}},et={name:"finite reflect",default_scale:3,init:function(t){var e=[p.xg(c.e8(4,2,0),1),p.xg(c.e8(4,6,0),1)],n=(0,l.d9)(O),i=(0,l.d9)(O);n.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]},i.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]};var r=(0,l.d9)($),o=(0,l.d9)($);r.max=2,r.h0=-1/0,o.max=1,o.h0=-1/0,J(r)(n.listener),J(o)(i.listener);var s=6/t,u=1*t,h=3*t,_={duration:40*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},f=new k(p.xg(c.cI,2),O).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),d=0,y=function(t,e,n,i){return z((function(r){return[G([z((function(o){return[z((function(u){return[function(){return a.n.INSTANCE.add(new k(t,i).simpleInit(f.px,f.py,s,d+n*Math.PI*2*(r/8/4+u/4+o/4/8/e*.5)))}]}),8),u]}),e)]),h]}),8)};return new j([function(){return a.n.INSTANCE.add(f)},30*t,z((function(t){return[function(){return d=Math.random()*Math.PI*2},y(e[0],10,1,n),10*u,B.random(f,_),y(e[1],15,-1,i),20*u,B.random(f,_)]}))])}},nt={name:"reflect laser",default_scale:3,init:function(t){var e=function(e,n){var i=p.iW(4,e,n,1,1,1,.75),r={render_layer:O.render_layer,collide_group:O.collide_group,collide_mask:O.collide_mask,warning_time:0,open_time:0,alive_time:1/0,close_time:0,listener:null},o=(0,l.d9)(r);r.listener={onInit:[],onUpdate:[],onPostMotion:[],onStateChange:[],onPostUpdate:[],onAttack:[],onContact:[],onDestroy:[]};var s,u=(0,l.d9)(Q);return u.max=2,u.v=8/t,u.maxlen=128,u.body=i,u.cf=o,u.name=e+"-"+n,(s=u,function(t){var e=function(t,e){var n=t.custom_fields;if(n.togrow>0){var i=Math.min(n.togrow,s.v*e);e-=i/s.v,t.len+=i,n.togrow-=i}e>0&&(t.px+=e*n.vx,t.py+=e*n.vy),t.shaped_sprite.end.shape.rawExitScreen(t.px+t.len*Math.cos(t.dir),t.py+t.len*Math.sin(t.dir),t.shaped_sprite.base,P.SH,P.ZP)&&t.shaped_sprite.base.shape.rawExitScreen(t.px,t.py,t.shaped_sprite.base,P.SH,P.ZP)&&(t.state=3)},n=function(t,e){return t>s.w0&&t<s.w1&&e>s.h0&&e<s.h1},i=function(t,e){var n=t.custom_fields;if(n.toshrink>0){var i=Math.min(n.toshrink,s.v*e);t.len-=i,n.toshrink-=i,n.toshrink<=0&&(t.state=3)}n.togrow>0&&(e-=(i=Math.min(n.togrow,s.v*e))/s.v,t.len+=i,n.togrow-=i),e>0&&(t.px+=e*n.vx,t.py+=e*n.vy),t.shaped_sprite.base.shape.rawExitScreen(t.px,t.py,t.shaped_sprite.base,P.SH,P.ZP)&&(t.state=3)};t.onInit.push((function(t){var n=t.custom_fields;n.ref_count=0,n.vx=s.v*Math.cos(t.dir),n.vy=s.v*Math.sin(t.dir),n.togrow=s.maxlen,n.toshrink=0,t.motion=e})),t.onPostMotion.push((function(t,e){var r=t.custom_fields,o=(n(t.px,t.py),t.px+t.len*Math.cos(t.dir)),u=t.py+t.len*Math.sin(t.dir);if(!n(o,u)&&r.ref_count<s.max){var c=new V.Fu(s.body,s.cf,i);c.init(t.px,t.py,t.dir,t.len);var p=c.custom_fields;p.vx=r.vx,p.vy=r.vy,p.togrow=r.togrow,a.n.INSTANCE.add(c);var h=0,l=0;r.ref_count<s.max&&o<=s.w0&&(h=s.w0,l=t.py+(s.w0-t.px)*r.vy/r.vx,r.ref_count++,r.vx=-r.vx,t.px=2*s.w0-t.px),r.ref_count<s.max&&o>=s.w1&&(h=s.w1,l=t.py+(s.w1-t.px)*r.vy/r.vx,r.ref_count++,r.vx=-r.vx,t.px=2*s.w1-t.px),r.ref_count<s.max&&u<=s.h0&&(l=s.h0,h=t.px+(s.h0-t.py)*r.vx/r.vy,r.ref_count++,r.vy=-r.vy,t.py=2*s.h0-t.py),r.ref_count<s.max&&u>=s.h1&&(l=s.h1,h=t.px+(s.h1-t.py)*r.vx/r.vy,r.ref_count++,r.vy=-r.vy,t.py=2*s.h1-t.py);var _=Math.sqrt(Math.pow(t.px-h,2)+Math.pow(t.py-l,2));t.len-=_,t.px=h,t.py=l,r.togrow+=_,c.len=_,p.toshrink=_+p.togrow,t.dir=Math.atan2(r.vy,r.vx)}}))})(r.listener),[i,r,u]},n=[e(6,3),e(2,1)],i=2*Math.PI/t,r=t,o=function(t,e,i,r,o,s){return z((function(t){return[z((function(o){return[function(){return a.n.INSTANCE.add(new V.Fu(n[e][0],n[e][1],null).init(0,0,s+2*Math.PI/i*o+r*t,0))}]}),i),o]}),t)};return new j([30*t,z((function(e){return[o(20,0,3,(e%2*2-1)*i*.0678,6*r,2*Math.random()*Math.PI),100*t,o(120,1,1,(e%2*2-1)*i*.0234,r,2*Math.random()*Math.PI),100*t]}))])}},it=n(533),rt={name:"Test Special Effect",default_scale:1,init:function(t){var e=p.xg(c.e8(1,2,0),1),n=p.xg(c.OE(0,0,1),1),i=O,r=(0,l.d9)(O);r.life=160*t,r.kill_on_exit=!1,r.kill_by=function(){return!1};var o=6/t,s=.4*o,u=2*t,h=6*t;return new j([30*t,z((function(c){return[function(){return a.n.INSTANCE.special_effects.time_slowdown(1/4,4*(8*h+120/o))},(p=c%2*2-1,l=Math.PI/3,void 0===_&&(_=Math.PI/2),z((function(t){return[G((function(c,h){return void 0===h&&(h=c.custom_fields),[function(){var e=_+2*Math.PI*t/8*p,i=e+Math.PI/2*p;a.n.INSTANCE.add(h.host=new k(n,r).simpleInit(160*Math.cos(e)-240*Math.cos(i),160*Math.sin(e)-240*Math.sin(i),o,i))},Math.round(120/o),function(){h.plx=it.U.INSTANCE.px,h.ply=it.U.INSTANCE.py},z((function(){return[function(){h.dir=Math.atan2(h.ply-h.host.py,h.plx-h.host.px)},z((function(t){return[z((function(n){return[function(){return a.n.INSTANCE.add(new k(e,i).simpleInit(h.host.px,h.host.py,s*(2+n)/4,h.dir+(t-1)*l))}]}),3)]}),3),u]}),Math.round(240/o/u))]})),h]}),8)),240*t];var p,l,_}))])}},ot={name:"RayLaser Hitbox Test",default_scale:3,init:function(t){var e=function(t,e,n){return p.iW(t,2,1,1,e,n,1)},n=[e(0,0,0),e(0,1,1),e(0,0,1),e(0,1,0),e(4,0,0),e(4,1,1),e(4,0,1),e(4,1,0),e(1,0,0),e(1,1,0)],i={render_layer:O.render_layer,collide_group:O.collide_group,collide_mask:O.collide_mask,warning_time:30*t,open_time:10*t,alive_time:6e3*t,close_time:10*t,listener:null},r=0*Math.PI*2/240/t;return new j([30*t,z((function(e){return[z((function(t){return[function(){return a.n.INSTANCE.add(new V.Fu(n[t],i,(o=r*(e%2*2-1),function(t,e){return t.dir+=e*o})).init(50*Math.cos(2*Math.PI/10*t),50*Math.sin(2*Math.PI/10*t),2*Math.PI/10*t,100));var o}]}),10),6e3*t]}))])}},at={name:"Local Variable Test",default_scale:1,init:function(t){var e=(0,l.d9)(O);e.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]},e.listener.onAttack.push((function(t){return t.custom_fields.callback()}));var n=[[p.xg(c.e8(3,6,0),1),p.xg(c.OE(0,1,1),1)],[p.xg(c.e8(3,2,0),1),p.xg(c.OE(0,0,1),1)],[p.xg(c.e8(3,13,0),1),p.xg(c.OE(0,3,1),1)],[p.xg(c.e8(3,10,0),1),p.xg(c.OE(0,2,1),1)]],i={duration:40*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},r=2.5/t;return new j([60*t,z((function(o){return[G((s=o,function(t,o){return void 0===o&&(o=t.custom_fields),[function(){var t=Math.random()*Math.PI*2;o.px=50*Math.cos(t),o.py=64+50*Math.sin(t),o.count=0},z([z((function(t){return[function(){return a.n.INSTANCE.add(new k(0==o.count?n[s][0]:n[s][1],e).simpleInit(o.px,o.py,r,2*Math.PI/40*t).init((function(t,e){void 0===e&&(e=t.custom_fields),e.callback=function(){return o.count++}})))}]}),40),function(){return o.count=0},B.random(o,i)])]})),150*t];var s}),4)])}},st=Object.values(i),ut=Object.values(r)},869:(t,e,n)=>{"use strict";n.d(e,{T:()=>i,ZE:()=>r,yR:()=>o,A4:()=>a,t_:()=>s,T7:()=>u,KZ:()=>c,DV:()=>p,P4:()=>h,k8:()=>l,Gs:()=>_,Io:()=>f,NH:()=>d,t4:()=>y,bm:()=>v,$7:()=>m,d9:()=>w,S:()=>b});var i=0,r=1,o=2,a=3,s=4,u=5,c=0,p=1,h=1,l=1,_=14,f=0,d=0,y=100,v=500,m=700;function w(t){return Object.assign({},t)}var b={render_layer:m,collide_group:i,collide_mask:c}},296:(t,e,n)=>{"use strict";n.d(e,{cE:()=>u,Fu:()=>c});var i,r,o=n(566),a=n(822),s=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(e){var n=t.call(this)||this;return n.func=e,n}return s(e,t),e.prototype.distanceTo=function(t,e,n){return Math.min(this.func(t,e,n),t.shaped_sprite.base.shape.rawDistanceTo(t.px,t.py,1,e,n),t.shaped_sprite.end.shape.rawDistanceTo(t.px+t.len*Math.cos(t.dir),t.py+t.len*Math.sin(t.dir),1,e,n))},e.line_circle=function(t,e,n){var i=t.px+t.shaped_sprite.hitbox_width*Math.cos(t.dir),r=t.py+t.shaped_sprite.hitbox_width*Math.sin(t.dir),o=t.px+(t.len-t.shaped_sprite.hitbox_width)*Math.cos(t.dir),a=t.py+(t.len-t.shaped_sprite.hitbox_width)*Math.sin(t.dir),s=Math.sqrt(Math.pow(i-o,2)+Math.pow(r-a,2)),u=Math.abs((o-i)*(r-n)-(i-e)*(a-r)),c=Math.sqrt(Math.pow(i-e,2)+Math.pow(r-n,2)),p=Math.sqrt(Math.pow(o-e,2)+Math.pow(a-n,2));return Math.pow(Math.max(c,p),2)>Math.pow(Math.min(c,p),2)+Math.pow(s,2)?Math.min(c,p)-t.shaped_sprite.hitbox_width*t.w:Math.min(u/s,c,p)-t.shaped_sprite.hitbox_width*t.w},e.double_arc=function(t,e,n){var i=e-t.px,r=n-t.py,a=i*Math.cos(-t.dir)-r*Math.sin(-t.dir),s=i*Math.sin(-t.dir)+r*Math.cos(-t.dir);return o.HC.orthDis(a-t.len/2,s,t.len/2,t.w*t.shaped_sprite.hitbox_width)},e.half_arc=function(t,e,n){var i=e-t.px,r=n-t.py,a=i*Math.cos(-t.dir)-r*Math.sin(-t.dir),s=i*Math.sin(-t.dir)+r*Math.cos(-t.dir);return a<0?Math.sqrt(Math.pow(a,2)+Math.pow(s,2)):o.HC.orthDis(a,s,t.len,t.w*t.shaped_sprite.hitbox_width)},e}(o.bn),c=(r=o.Yw,s((function(){return null!==r&&r.apply(this,arguments)||this}),r),function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.state=0,r.rstate=0,r.time=0,r.custom_fields={},r.config=n,r.motion=i,r}return s(e,t),e.prototype.init=function(t,e,n,i){return this.len=i,this.dir=n,this.px=t,this.py=e,this.checkState(),this},e.prototype.checkState=function(){var t,e,n,i,r,o,a,s,u,c,p=this;0==this.state&&(this.state=2,null===(e=null===(t=this.config.listener)||void 0===t?void 0:t.onInit)||void 0===e||e.forEach((function(t){return t(p)})));var h=this.config.warning_time,l=this.config.open_time+h,_=this.config.alive_time+l,f=this.config.close_time+_;0==this.rstate&&this.time>=h&&(this.rstate=1,null===(i=null===(n=this.config.listener)||void 0===n?void 0:n.onStateChange)||void 0===i||i.forEach((function(t){return t(p)}))),1==this.rstate&&(this.w=Math.min(1,(this.time-h)/(l-h)),this.time>=l&&(this.rstate=2,this.state=1,this.w=1,null===(o=null===(r=this.config.listener)||void 0===r?void 0:r.onStateChange)||void 0===o||o.forEach((function(t){return t(p)})))),2==this.rstate&&this.time>=_&&(this.rstate=3,this.state=2,null===(s=null===(a=this.config.listener)||void 0===a?void 0:a.onStateChange)||void 0===s||s.forEach((function(t){return t(p)}))),3==this.rstate&&(this.w=Math.max(0,1-(this.time-_)/(f-_)),this.time>=f&&(this.state=3,null===(c=null===(u=this.config.listener)||void 0===u?void 0:u.onDestroy)||void 0===c||c.forEach((function(t){return t(p)}))))},e.prototype.update=function(t){var e,n,i,r,o,s,u=this;0==this.state&&(this.state=2,null===(n=null===(e=this.config.listener)||void 0===e?void 0:e.onInit)||void 0===n||n.forEach((function(t){return t(u)})));var c=a.n.INSTANCE.special_effects.time_rate;this.time+=c,this.checkState(),null===(r=null===(i=this.config.listener)||void 0===i?void 0:i.onUpdate)||void 0===r||r.forEach((function(t){return t(u,c)})),this.motion(this,c),null===(s=null===(o=this.config.listener)||void 0===o?void 0:o.onPostMotion)||void 0===s||s.forEach((function(t){return t(u,c)}))},e.prototype.postUpdate=function(t){var e,n,i=this;null===(n=null===(e=this.config.listener)||void 0===e?void 0:e.onPostUpdate)||void 0===n||n.forEach((function(t){return t(i)}))},e.prototype.attack=function(t,e){var n,i,r=this;null===(i=null===(n=this.config.listener)||void 0===n?void 0:n.onAttack)||void 0===i||i.forEach((function(t){return t(r,e)})),e.damaged(e,this)},e.prototype.damaged=function(t,e){var n,i,r=this;return null===(i=null===(n=this.config.listener)||void 0===n?void 0:n.onContact)||void 0===i||i.forEach((function(t){return t(r,e)})),!1},e}(function(t){function e(e){var n=t.call(this,0,e)||this;return n.w=0,n}return s(e,t),e.prototype.rectCount=function(){return 3},e.prototype.render=function(t,e){var n=this.shaped_sprite.l_ratio*this.len/2;t[10*e+0]=this.px+n*Math.cos(this.dir),t[10*e+1]=this.py+n*Math.sin(this.dir),t[10*e+2]=this.dir+Math.PI/2,t[10*e+3]=Math.max(1,this.shaped_sprite.sprite_width*this.w),t[10*e+4]=n;var i=this.shaped_sprite.sprite;t[10*e+5]=i.tx/i.sprite.w,t[10*e+6]=i.ty/i.sprite.h,t[10*e+7]=i.tw/i.sprite.w,t[10*e+8]=i.th/i.sprite.h,t[10*e+9]=1,e++;var r=this.shaped_sprite.base;t[10*e+0]=this.px,t[10*e+1]=this.py,t[10*e+2]=this.dir+Math.PI/2,t[10*e+3]=r.w/2,t[10*e+4]=r.h/2,i=r.sprite,t[10*e+5]=i.tx/i.sprite.w,t[10*e+6]=i.ty/i.sprite.h,t[10*e+7]=i.tw/i.sprite.w,t[10*e+8]=i.th/i.sprite.h,t[10*e+9]=1,e++,r=this.shaped_sprite.end,t[10*e+0]=this.px+this.len*Math.cos(this.dir),t[10*e+1]=this.py+this.len*Math.sin(this.dir),t[10*e+2]=this.dir+Math.PI/2,t[10*e+3]=r.w/2,t[10*e+4]=r.h/2,i=r.sprite,t[10*e+5]=i.tx/i.sprite.w,t[10*e+6]=i.ty/i.sprite.h,t[10*e+7]=i.tw/i.sprite.w,t[10*e+8]=i.th/i.sprite.h,t[10*e+9]=1},e}(o.hE)))},533:(t,e,n)=>{"use strict";n.d(e,{f:()=>h,U:()=>l});var i,r=n(566),o=n(68),a=n(349),s=n(869),u=n(822),c=n(924),p=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),h=function(){function t(t,e,n){this.shoot=t,this.bomb=e,this.ability=n}return t.prototype.updateShoot=function(t,e){var n;return null===(n=this.shoot)||void 0===n?void 0:n.updateEnable(t,e)},t.prototype.updateBomb=function(t,e){var n;return null===(n=this.bomb)||void 0===n?void 0:n.updateEnable(t,e)},t.prototype.updateAbility=function(t,e){var n;return null===(n=this.ability)||void 0===n?void 0:n.updateEnable(t,e)},t.prototype.render=function(t,e){var n,i,r;null===(n=this.shoot)||void 0===n||n.render(t,e),null===(i=this.bomb)||void 0===i||i.render(t,e),null===(r=this.ability)||void 0===r||r.render(t,e)},t.prototype.layers=function(){var t=[];return this.shoot&&(t=t.concat(this.shoot.layers())),this.bomb&&(t=t.concat(this.bomb.layers())),this.ability&&(t=t.concat(this.ability.layers())),t},t}(),l=function(t){function e(n,i,r,o,a){var u=t.call(this,2,null)||this;return u.config=s.S,u.state=1,u.time=0,u.missed=!1,u.bombed=!1,u.grazed=!1,u.post_grazed=!1,u.pre_miss=0,u.miss_time=0,u.invince_time=0,u.px=0,u.py=0,u.dir=0,u.prex=0,u.prey=0,u.graze_total=0,u.graze_current=0,u.magn=1,u.collideCheck=function(t){for(var e=Math.sqrt(Math.pow(u.px-u.prex,2)+Math.pow(u.py-u.prey,2)),n=Math.max(1,Math.ceil(e/2)),i=1/0,r=0;r<n;r++){var o=u.px+(u.prex-u.px)*r/n,a=u.py+(u.prey-u.py)*r/n;i=Math.min(i,t.distanceTo(o,a))}var s=u.sprite.shape.radius*u.ability.radius*u.magn;return i-s<u.ability.graze_radius&&(u.grazed=!0),i<s},e.INSTANCE=u,u.proto=i,u.ability=r,u.sprite=n,u.px=o,u.py=a,u.dir=0,u.bomb_count=r.init_bomb,u.life_count=r.init_life,u.ability_count=r.init_ability,u.renderType=2,u}return p(e,t),e.updateState=function(t){e.action=t},e.prototype.update=function(t){if(e.action){this.prex=this.px,this.prey=this.py;var n=u.n.INSTANCE.special_effects.time_rate;this.time+=n,this.px+=e.action.pos_x,this.py+=e.action.pos_y,this.px<-a.SH&&(this.px=-a.SH),this.px>a.SH&&(this.px=a.SH),this.py<-a.ZP&&(this.py=-a.ZP),this.py>a.ZP&&(this.py=a.ZP),this.dir=this.time*this.sprite.sprite.omega,this.bombed=this.proto.updateShoot(this,e.action.key_z),this.bombed||(this.bombed=this.proto.updateBomb(this,e.action.key_x)),this.bombed||(this.bombed=this.proto.updateAbility(this,e.action.key_c))}},e.prototype.postUpdate=function(t){this.post_grazed=this.grazed,this.grazed&&(this.graze_current<this.ability.max_graze&&(this.graze_current+=u.n.INSTANCE.special_effects.time_rate),this.graze_total++,this.graze_current>=this.ability.max_graze&&this.ability_count<this.ability.max_ability&&(this.ability_count++,this.graze_current=0),this.grazed=!1),this.miss_time>0&&this.miss_time--,this.pre_miss>0&&(this.pre_miss--,0==this.pre_miss&&(console.log("missed"),this.miss_time=this.ability.miss_time)),this.missed&&(this.missed=!1,this.pre_miss=this.ability.pre_miss),this.bombed&&(this.bombed=!1,this.miss_time=this.ability.bomb_time,this.pre_miss>0&&(console.log("bomb after miss"),this.pre_miss=0)),this.miss_time>0||this.pre_miss>0?(this.state=2,this.invince_time++,Math.floor(this.invince_time/6)%2==0?this.shaped_sprite=null:this.shaped_sprite=this.sprite):(this.state=1,this.invince_time=0,this.shaped_sprite=this.sprite)},e.prototype.attack=function(t,e){},e.prototype.damaged=function(t,e){return 0==this.pre_miss&&0==this.miss_time&&(this.missed=!0),e.damaged(e,this)},e.prototype.layers=function(){return function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i}(this.proto.layers(),[s.$7])},e.prototype.render=function(t){var e,n=[],i=0,r=null;this.proto.render(t,this),t==s.$7&&(null===(e=this.shaped_sprite)||void 0===e?void 0:e.sprite)&&(function(t,e,a,s,u){n.push(t),n.push(e),n.push(a+Math.PI/2),n.push(u.w/2),n.push(u.h/2);var c=u.sprite;n.push(c.tx/c.sprite.w),n.push(c.ty/c.sprite.h),n.push(c.tw/c.sprite.w),n.push(c.th/c.sprite.h),n.push(1),i++,r=o.Z.get(c.sprite.path).img}(this.px,this.py,this.dir,0,this.shaped_sprite),c.setMode(0),c.drawRects(new Float32Array(n),i,r))},e.INSTANCE=null,e.action=null,e}(r.hE)},822:(t,e,n)=>{"use strict";n.d(e,{n:()=>s});var i=n(869),r=n(566),o=n(68),a=function(){function t(){this.time_rate=1,this.list=[]}return t.prototype.process=function(){this.time_rate=this.list.reduce((function(t,e){return t*e.rate}),1),this.list=this.list.filter((function(t){return t.duration--}))},t.prototype.time_slowdown=function(t,e){this.list.push({rate:t,duration:e})},t}(),s=function(){function t(){this.groups=[],this.pending=[],this.update_stage=0,this.time=0,this.special_effects=new a,t.INSTANCE=this,this.groups.push({id:i.T,mask:i.KZ,list:[]}),this.groups.push({id:i.ZE,mask:i.DV,list:[]}),this.groups.push({id:i.yR,mask:i.P4,list:[]}),this.groups.push({id:i.A4,mask:i.k8,list:[]}),this.groups.push({id:i.t_,mask:i.Gs,list:[]}),this.groups.push({id:i.T7,mask:i.Io,list:[]})}return t.prototype.registerGroup=function(t){var e=this.groups.length;return this.groups.push({id:e,mask:t,list:[]}),e},t.prototype.add=function(t){3!=this.update_stage&&0!=this.update_stage?this.pending.push(t):this.groups[t.config.collide_group].list.push(t)},t.prototype.update=function(){var t=this;this.update_stage=1,this.groups.forEach((function(t){return t.list.forEach((function(t){return t.update(t)}))}));for(var e=0;e<this.groups.length;e++)for(var n=0;n<this.groups.length;n++)if(this.groups[e].mask&1<<n)for(var i=0,o=this.groups[e].list;i<o.length;i++){var a=o[i];if(1==a.state&&a.shaped_sprite&&a.shaped_sprite.shape)for(var s=0,u=this.groups[n].list;s<u.length;s++){var c=u[s];1==c.state&&c.shaped_sprite&&c.shaped_sprite.shape&&(0,r._R)(a,c)&&a.attack(a,c)}}this.update_stage=2,this.groups.forEach((function(t){return t.list.forEach((function(t){return t.postUpdate(t)}))})),this.groups.forEach((function(t){return t.list=t.list.filter((function(t){return 3!=t.state}))})),this.update_stage=3,this.special_effects.process(),this.pending.forEach((function(e){return t.add(e)})),this.pending=[],this.time++},t.prototype.render=function(){var t,e,n,i,r,a,s,u;return r=this,a=void 0,u=function(){var r,a,s,u,c,p,h,l,_,f,d,y;return function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(v){for(r=new Map,a=[],s=0,u=this.groups;s<u.length;s++)for(c=u[s],p=0,h=c.list;p<h.length;p++)2!=(l=h[p]).renderType?l.config.render_layer&&(null===(t=l.shaped_sprite)||void 0===t?void 0:t.sprite)&&(r.has(l.config.render_layer)||r.set(l.config.render_layer,new Map),f=r.get(l.config.render_layer),d=null===(i=null===(n=null===(e=l.shaped_sprite)||void 0===e?void 0:e.sprite)||void 0===n?void 0:n.sprite)||void 0===i?void 0:i.path,f.has(d)||f.set(d,[]),f.get(d).push(l)):(_=l,a.push(_),_.layers().forEach((function(t){return r.set(t,new Map)})));return y=[],r.forEach((function(t,e){return y.push({rl:e,v:t})})),y.sort((function(t,e){return t.rl-e.rl})),y.forEach((function(t){a.forEach((function(e){return e.render(t.rl)})),t.v.forEach((function(t,e){return o.Z.get(e).draw(t)}))})),[2]}))},new((s=void 0)||(s=Promise))((function(t,e){function n(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(e){var r;e.done?t(e.value):(r=e.value,r instanceof s?r:new s((function(t){t(r)}))).then(n,i)}o((u=u.apply(r,a||[])).next())}))},t}()},176:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{S:()=>init});var _entity_SelfMachine__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(533),_stage_EntityPool__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(822),_util_shaped_sprites__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(583),_util_sprites__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(940),_util_SpriteManager__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(68),_data_index__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(85),__awaiter=function(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((i=i.apply(t,e||[])).next())}))},__generator=function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},sm_abi={radius:1,pre_miss:30,miss_time:60,bomb_time:60,graze_radius:24,max_graze:600,init_bomb:3,init_life:3,init_ability:5,max_bomb:10,max_life:10,max_ability:5},stage_settings={init,stage:6,scale:1,ability:1,stage_list:_data_index__WEBPACK_IMPORTED_MODULE_5__.K,ability_list:_data_index__WEBPACK_IMPORTED_MODULE_5__.p},sinit={load_sprite:function(){return _util_SpriteManager__WEBPACK_IMPORTED_MODULE_4__.Z.get(_util_sprites__WEBPACK_IMPORTED_MODULE_3__.Xp.path).load()},add_player:function(){return new _entity_SelfMachine__WEBPACK_IMPORTED_MODULE_0__.U(_util_shaped_sprites__WEBPACK_IMPORTED_MODULE_2__.xg(_util_sprites__WEBPACK_IMPORTED_MODULE_3__.a_,1),new _entity_SelfMachine__WEBPACK_IMPORTED_MODULE_0__.f(null,null,_data_index__WEBPACK_IMPORTED_MODULE_5__.p[stage_settings.ability].init()),sm_abi,0,-192)},add_schedule:null};function init(){return __awaiter(this,void 0,void 0,(function(){var pool;return __generator(this,(function(_a){switch(_a.label){case 0:return[4,sinit.load_sprite()];case 1:return _a.sent(),pool=new _stage_EntityPool__WEBPACK_IMPORTED_MODULE_1__.n,pool.add(sinit.add_player()),pool.add(_data_index__WEBPACK_IMPORTED_MODULE_5__.K[stage_settings.stage].init(stage_settings.scale)),eval("window.debug_info.pool = pool"),eval("window.debug_info.stage = stage_settings"),[2]}}))}))}},566:(t,e,n)=>{"use strict";n.d(e,{bn:()=>a,D8:()=>u,HC:()=>c,Yw:()=>p,hE:()=>h,eY:()=>l,u5:()=>_,_R:()=>f});var i,r,o=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(){},s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e}(a),u=function(t){function e(e){var n=t.call(this)||this;return n.radius=e,n}return o(e,t),e.prototype.exitScreen=function(t){return Math.sqrt(Math.pow(t.shaped_sprite.w,2)+Math.pow(t.shaped_sprite.h,2))*t.magn},e.prototype.distanceTo=function(t,e,n){return Math.sqrt(Math.pow(e-t.px,2)+Math.pow(n-t.py,2))-this.radius*t.magn},e.prototype.rawDistanceTo=function(t,e,n,i,r){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2))-this.radius*n},e.prototype.rawExitScreen=function(t,e,n,i,r){var o=Math.sqrt(Math.pow(n.w,2)+Math.pow(n.h,2));return Math.abs(t)>i+o||Math.abs(e)>r+o},e}(s),c=function(t){function e(e,n){var i=t.call(this)||this;return i.len=e,i.rad=n,i}return o(e,t),e.orthDis=function(t,e,n,i){var r=i/2;t=Math.abs(t);var o=n*n/r/2+r/2-r;return(e=Math.abs(e))>=0&&n*(e+o)>t*o?Math.sqrt(Math.pow(t,2)+Math.pow(e+o,2))-o-r:Math.sqrt(Math.pow(t-n,2)+Math.pow(e,2))-r},e.prototype.exitScreen=function(t){return Math.sqrt(Math.pow(t.shaped_sprite.w,2)+Math.pow(t.shaped_sprite.h,2))*t.magn},e.prototype.distanceTo=function(t,n,i){var r=n-t.px,o=i-t.py,a=r*Math.cos(-t.dir)-o*Math.sin(-t.dir),s=r*Math.sin(-t.dir)+o*Math.cos(-t.dir);return e.orthDis(a,s,this.len/2*t.magn,this.rad*t.magn)},e}(s),p=function(){},h=(o((function(){return null!==r&&r.apply(this,arguments)||this}),r=p),function(){function t(t,e){this.collideCheck=null,this.renderType=t,this.shaped_sprite=e}return t.prototype.distanceTo=function(t,e){var n;return(null===(n=this.shaped_sprite)||void 0===n?void 0:n.shape)?this.shaped_sprite.shape.distanceTo(this,t,e):1/0},t}()),l=function(t){function e(e){var n=t.call(this,0,e)||this;return n.magn=1,n.alpha=1,n}return o(e,t),e.prototype.rectCount=function(){return 1},e.prototype.render=function(t,e){t[10*e+0]=this.px,t[10*e+1]=this.py,t[10*e+2]=this.dir+Math.PI/2,t[10*e+3]=this.shaped_sprite.w/2*this.magn,t[10*e+4]=this.shaped_sprite.h/2*this.magn;var n=this.shaped_sprite.sprite;t[10*e+5]=n.tx/n.sprite.w,t[10*e+6]=n.ty/n.sprite.h,t[10*e+7]=n.tw/n.sprite.w,t[10*e+8]=n.th/n.sprite.h,t[10*e+9]=this.alpha},e}(h),_=function(t){function e(){return t.call(this,null,null)||this}return o(e,t),e}(h);function f(t,e){if(t.collideCheck)return t.collideCheck(e);if(e.collideCheck)return e.collideCheck(t);if(t instanceof l&&t.shaped_sprite.shape instanceof u)return e.distanceTo(t.px,t.py)<t.shaped_sprite.shape.radius;if(e instanceof l&&e.shaped_sprite.shape instanceof u)return f(e,t);throw new Error("non-circle non-circle collision not found")}},68:(t,e,n)=>{"use strict";n.d(e,{Z:()=>r});var i=n(924),r=function(){function t(t){this.img=null,this.path=t}return t.prototype.loaded=function(){return this.img},t.prototype.load=function(){return t=this,e=void 0,r=function(){var t;return function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(e){switch(e.label){case 0:return[4,i.loadImage(this.path)];case 1:return t=e.sent(),this.img=i.loadTexture(t),[2]}}))},new((n=void 0)||(n=Promise))((function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}u((r=r.apply(t,e||[])).next())}));var t,e,n,r},t.get=function(e){return t.INS[e]?t.INS[e]:t.INS[e]=new t(e)},t.prototype.draw=function(t){this.drawRect(t,0),this.drawRect(t,1);for(var e=0,n=t;e<n.length;e++){var r=n[e];if(1==r.renderType)for(var o=r,a=o.getSprite(),s=a.sprite,u=0,c=o.render();u<c.length;u++){var p=c[u];i.drawSnake(p,a.w,p.length/2,s.tx,s.ty,s.tw,s.th,this.img)}}},t.prototype.drawRect=function(t,e){var n=t.reduce((function(t,n){return 0==n.renderType&&n.shaped_sprite.sprite.mode==e?t+n.rectCount():t}),0);if(n){i.setMode(e);for(var r=new Float32Array(10*n),o=0,a=0,s=t;a<s.length;a++){var u=s[a];if(0==u.renderType&&u.shaped_sprite.sprite.mode==e){var c=u;c.render(r,o),o+=c.rectCount()}}i.drawRects(r,n,this.img)}},t.INS={},t}()},583:(t,e,n)=>{"use strict";n.d(e,{xg:()=>c,p3:()=>p,iW:()=>h});var i=n(296),r=n(566),o=n(940),a=[[Math.sqrt(27),0],[2.4,2.4,4,4,2.4,2.4,2.4,2.8,2.4,2.4,4,2.4,2.4,2.4,2.4,2.4],[6,7,8.5,7,6,7,0,10],[14,14]],s=.75;function u(t){return Math.sqrt(Math.pow(t,2)+Math.pow(3,2))-3}function c(t,e){return e*=s,{sprite:t,shape:new r.D8(u(a[t.category][t.type])*e),w:t.tw*e,h:t.th*e,renderType:0}}function p(t,e,n){var i=(0,o.e8)(4,t,e);return{sprite:i,shape:new r.HC(n,u(a[1][4])*s),renderType:0,w:i.tw*s,h:1.25*n}}function h(t,e,n,r,a,p,h){var l=(0,o.e8)(t,e,r);return l.ty+=0==t?4:4==t||1==t?1:NaN,l.th-=0==t?8:4==t?2:1==t?1:NaN,{sprite:l,shape:new i.cE(0==t?i.cE.line_circle:1==t?i.cE.half_arc:4==t?i.cE.double_arc:null),renderType:0,sprite_width:l.tw*s/2*h,hitbox_width:u(2.4)*s*h,l_ratio:0==t||p>0?1:4==t?1.15:1==t?1.2:NaN,base:c((0,o.hZ)(0,n,r),a*h),end:c((0,o.hZ)(0,n,r),p*h)}}},940:(t,e,n)=>{"use strict";n.d(e,{Xp:()=>a,e8:()=>s,hZ:()=>u,OE:()=>c,a_:()=>p,cI:()=>h});var i=[0,0,1,1,0,0,0,0,0,1,1,1,1,0,0],r=[1,1,1,0,0,0,1,0],o=2*Math.PI/600,a={path:"assets/bullet_000.png",w:516,h:772};function s(t,e,n){return{sprite:a,tx:t<12?1+16*e:t<14?1+e%8*8:t<15?1:258+16*e,ty:t<12?1+16*t:t<14?(t<13?193:241)+8*(e>>3):e<15?515+16*e:449,tw:t<12?16:t<14?8:t<15?256:16,th:t<12?16:t<14?8:16,mode:n,category:1,type:t,color:e,omega:i[t]*o}}function u(t,e,n){return{sprite:a,tx:(t<7?1:258)+32*e,ty:0==t?209:t<7?226+32*t:257,tw:32,th:32,mode:n,category:2,type:t,color:e,omega:r[t]*o}}function c(t,e,n){return{sprite:a,tx:(0==t?1:258)+64*e,ty:0==t?449:290,tw:64,th:64,mode:n,category:3,type:t,color:e,omega:o}}var p={sprite:a,tx:258,ty:17,tw:64,th:64,mode:0,category:0,type:0,color:0,omega:o},h={sprite:a,tx:386,ty:81,tw:128,th:128,mode:0,category:0,type:2,color:0,omega:o}},235:()=>{const t=document.getElementById("stage_start"),e=document.getElementById("stage_dec"),n=document.getElementById("stage_inc"),i=document.getElementById("ability_set"),r=document.getElementById("ability_dec"),o=document.getElementById("ability_inc"),a=debug_info.stage,s=()=>{e.disabled=0==a.stage,n.disabled=a.stage==a.stage_list.length-1,t.value=`${a.stage_list[a.stage].name}`,r.disabled=0==a.ability,o.disabled=a.ability==a.ability_list.length-1,i.value=`${a.ability_list[a.ability].name}`,a.scale=a.stage_list[a.stage].default_scale};e.onclick=()=>{a.stage--,s()},n.onclick=()=>{a.stage++,s()},r.onclick=()=>{a.ability--,s()},o.onclick=()=>{a.ability++,s()},s()},924:(t,e,n)=>{"use strict";n.r(e),n.d(e,{global_gl:()=>r,setup:()=>o,setMode:()=>a,loadImage:()=>s,draw:()=>u,drawStrip:()=>c,loadTexture:()=>p,clear:()=>h,drawRects:()=>v,drawSnake:()=>m});var i=n(349);const r={gl:null,shader:{program:0,attribute:{coord:0,tex:0,alpha:0},uniform:{uSampler:0}}};function o(){var t=document.getElementById("glcanvas"),e=t.getContext("webgl");if(null===e)return void alert("Unable to initialize WebGL. Your browser or machine may not support it.");r.gl=e;var n=e.createShader(e.VERTEX_SHADER),i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,"\nattribute vec2 coord;\nattribute vec2 tex;\nattribute float alpha;\nvarying highp vec2 vTexCoord;\nvarying highp float vTexAlpha;\nvoid main() {\n    gl_Position = vec4(coord, 0.0, 1.0);\n    vTexCoord = tex;\n    vTexAlpha = alpha;\n}\n"),e.shaderSource(i,"\nprecision highp float;\nvarying highp vec2 vTexCoord;\nvarying highp float vTexAlpha;\nuniform sampler2D uSampler;\nvoid main() {\n    vec4 col = texture2D(uSampler, vTexCoord);\n    col.a *= vTexAlpha;\n    col.rgb *= col.a;\n    gl_FragColor = col;\n}\n"),e.compileShader(n),e.compileShader(i);var o=e.createProgram();e.attachShader(o,n),e.attachShader(o,i),e.linkProgram(o),e.useProgram(o);const a=r.shader;a.program=o,a.attribute.coord=e.getAttribLocation(o,"coord"),a.attribute.tex=e.getAttribLocation(o,"tex"),a.attribute.alpha=e.getAttribLocation(o,"alpha"),a.uniform.uSampler=e.getUniformLocation(o,"uSampler"),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.disable(e.DEPTH_TEST),e.viewport(0,0,t.width,t.height)}function a(t){const e=r.gl;0==t?e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA):e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE_MINUS_SRC_ALPHA)}function s(t){return new Promise(((e,n)=>{let i=new Image;i.onload=()=>e(i),i.onerror=n,i.src=t}))}function u(t,e,n,i,o){const a=r.gl,s=a.createBuffer(),u=r.shader.attribute.coord;a.bindBuffer(a.ARRAY_BUFFER,s),a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(u);const c=a.createBuffer(),p=r.shader.attribute.tex;a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW),a.vertexAttribPointer(p,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(p);const h=a.createBuffer(),l=r.shader.attribute.alpha;a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,n,a.STATIC_DRAW),a.vertexAttribPointer(l,1,a.FLOAT,!1,0,0),a.enableVertexAttribArray(l),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,i),a.uniform1i(r.shader.uniform.uSampler,0),a.drawArrays(a.TRIANGLES,0,o)}function c(t,e,n,i,o){const a=r.gl,s=a.createBuffer(),u=r.shader.attribute.coord;a.bindBuffer(a.ARRAY_BUFFER,s),a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(u);const c=a.createBuffer(),p=r.shader.attribute.tex;a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW),a.vertexAttribPointer(p,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(p);const h=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,h),a.bufferData(a.ELEMENT_ARRAY_BUFFER,n,a.STATIC_DRAW),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,i),a.uniform1i(r.shader.uniform.uSampler,0),a.drawElements(a.TRIANGLE_STRIP,o,a.UNSIGNED_SHORT,0)}function p(t,e=!0,n=!1){const i=r.gl,o=i.createTexture();return i.bindTexture(i.TEXTURE_2D,o),i.bindTexture(i.TEXTURE_2D,o),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_SHORT_4_4_4_4,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,n?i.REPEAT:i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,n?i.REPEAT:i.CLAMP_TO_EDGE),o}function h(){const t=r.gl;t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.clearColor(0,0,1,1)}const l=[-1,-1,1,-1,1,1],_=[-1,1,1,-1,-1,1],f=[0,0,1,0,1,1],d=[0,1,1,0,0,1];function y(t){for(var e=0;e<t.length/2;e++)t[2*e]=(0,i.OK)(t[2*e]),t[2*e+1]=(0,i.ZA)(t[2*e+1])}function v(t,e,n){const i=new Float32Array(12*e),r=new Float32Array(12*e),o=new Float32Array(6*e);for(var a=0;a<e;a++)for(var s=0;s<6;s++){const e=t[10*a+2],n=t[10*a+3]*l[s],u=t[10*a+4]*_[s];i[12*a+2*s+0]=t[10*a+0]+n*Math.cos(e)-u*Math.sin(e),i[12*a+2*s+1]=t[10*a+1]+n*Math.sin(e)+u*Math.cos(e),r[12*a+2*s+0]=t[10*a+5]+f[s]*t[10*a+7],r[12*a+2*s+1]=t[10*a+6]+d[s]*t[10*a+8],o[6*a+s]=t[10*a+9]}y(i),u(i,r,o,n,6*e)}function m(t,e,n,i,o,a,s,u){const c=new Float32Array(6*n),p=new Float32Array(n),h=new Float32Array(6*n),l=new Int16Array(2*(n-1));for(var _=0,f=0;f<n-1;f++){const n=t[2*f],i=t[2*f+1],r=t[2*f+2],o=t[2*f+3],a=(n+r)/2,s=(i+o)/2,u=Math.sqrt((r-n)*(r-n)+(o-i)*(o-i));p[f]=u,_+=u,c[6*f+0]=n,c[6*f+1]=i,c[6*f+2]=a-(s-i)/u*e,c[6*f+3]=s+(a-n)/u*e,c[6*f+4]=a+(s-i)/u*e,c[6*f+5]=s-(a-n)/u*e}y(c),_-=p[0]/2+p[n-1]/2;var d=-p[0]/2;for(f=1;f<n;f++)h[6*f+0]=i+a*d/_,h[6*f+1]=o+s/2,d+=p[f]/2,h[6*f+2]=i+a*d/_,h[6*f+3]=o,h[6*f+4]=i+a*d/_,h[6*f+5]=o+s,d+=p[f]/2;for(f=0;f<n-1;f++)l[2*f+0]=3*f+1,l[2*f+1]=3*f+3;l[2*n-3]--;const v=r.gl,m=v.createBuffer(),w=r.shader.attribute.coord;v.bindBuffer(v.ARRAY_BUFFER,m),v.bufferData(v.ARRAY_BUFFER,c,v.STATIC_DRAW),v.vertexAttribPointer(w,2,v.FLOAT,!1,0,0),v.enableVertexAttribArray(w);const b=v.createBuffer(),g=r.shader.attribute.tex;v.bindBuffer(v.ARRAY_BUFFER,b),v.bufferData(v.ARRAY_BUFFER,h,v.STATIC_DRAW),v.vertexAttribPointer(g,2,v.FLOAT,!1,0,0),v.enableVertexAttribArray(g),v.activeTexture(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,u),v.uniform1i(r.shader.uniform.uSampler,0);const x=v.createBuffer();for(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,x),v.bufferData(v.ELEMENT_ARRAY_BUFFER,l,v.STATIC_DRAW),v.drawElements(v.TRIANGLE_STRIP,2*n-2,v.UNSIGNED_SHORT,0),f=0;f<n-1;f++)l[2*f+0]=3*f,l[2*f+1]=3*f+2;l[0]++,v.bufferData(v.ELEMENT_ARRAY_BUFFER,l,v.STATIC_DRAW),v.drawElements(v.TRIANGLE_STRIP,2*n-2,v.UNSIGNED_SHORT,0)}window.debug_info={},window.debug_info.global_gl=r,window.debug_info.gl_func={setup:o,clear:h,draw:u,drawStrip:c,drawRects:v,drawSnake:m}}},__webpack_module_cache__={};function __webpack_require__(t){if(__webpack_module_cache__[t])return __webpack_module_cache__[t].exports;var e=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](e,e.exports,__webpack_require__),e.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};__webpack_require__.r(t),__webpack_require__.d(t,{KEY_CLICK:()=>N,KEY_PRESS:()=>O,canvas_height:()=>y,canvas_width:()=>d,devicePixelRatio:()=>b,keys:()=>A,last_update_rate:()=>g,mainloop_start:()=>P,mainloop_terminate:()=>S,mouse:()=>M,setup_canvas:()=>T,test_fps:()=>x});var e,n,i=__webpack_require__(176),r=__webpack_require__(924),o=__webpack_require__(822),a=__webpack_require__(533),s=__webpack_require__(349),u=__webpack_require__(780),c=!1,p=!1,h=0,l=0,_=0,f=0;var d,y,v=0,m=0,w=null,b=1,g=1;function x(){return v=performance.now(),m=241,E(),new Promise(((t,e)=>{w=t}))}function E(){if(--m)requestAnimationFrame(E);else{var t=(performance.now()-v)/240;g=Math.round(t/(1e3/60)),w(g)}}var M={x:0,y:0},A={};function T(){document.onmousemove=t=>{M.x=t.pageX,M.y=t.pageY},document.ontouchstart=t=>{A._touch=3,M.x=t.pageX,M.y=t.pageY,t.preventDefault()},document.ontouchend=t=>{A._touch=1,M.x=t.pageX,M.y=t.pageY,t.preventDefault()},document.ontouchmove=t=>{M.x=t.pageX,M.y=t.pageY,t.preventDefault()},document.onmousedown=t=>{A._press=3},document.onmouseup=t=>{A._press=1},document.addEventListener("keydown",(t=>{var e=t.key;1==e.length&&(e=e.toLowerCase()),A[e]=3}),!1),document.addEventListener("keyup",(t=>{var e=t.key;1==e.length&&(e=e.toLowerCase()),A[e]=1}),!1);var t=window.innerWidth,e=window.innerHeight,n=.95*Math.min(t/s.Fy,e/s.bE),i=document.getElementById("glcanvas");d=n*s.Fy,y=n*s.bE,i.style.width=d+"px",i.style.height=y+"px",b=window.devicePixelRatio||1,i.width=d*b,i.height=y*b,r.setup()}var I=!1;async function P(){I||(I=!0,await function(){return t=this,i=void 0,a=function(){var t,i,o,a;return function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(s){switch(s.label){case 0:return i=(t=r).loadTexture,[4,r.loadImage("assets/ui_bg.png")];case 1:return e=i.apply(t,[s.sent(),!1,!0]),a=(o=r).loadTexture,[4,r.loadImage("assets/scene_bg.png")];case 2:return n=a.apply(o,[s.sent(),!1,!0]),[2]}}))},new((o=void 0)||(o=Promise))((function(e,n){function r(t){try{u(a.next(t))}catch(t){n(t)}}function s(t){try{u(a.throw(t))}catch(t){n(t)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(r,s)}u((a=a.apply(t,i||[])).next())}));var t,i,o,a}(),R())}function S(){I=!1}function R(){!function(){var t=o.n.INSTANCE;if(t){var i=function(){if(A.Escape==N&&(c=!c),c)return p=!1,null;var t=0,e=0;A.Shift>=O||A._touch>=O||A._press>=O?(p||(p=!0,h=M.x,l=M.y,_=0,f=0),t=M.x-h-_,e=M.y-l-f,_+=t,f+=e):p=!1,t=t/d*s.Fy*2,e=-e/y*s.bE*2;var n=A.Shift>=O?2:3;return(A.w>=O||A.ArrowUp>=O)&&(e+=n),(A.s>=O||A.ArrowDown>=O)&&(e-=n),(A.a>=O||A.ArrowLeft>=O)&&(t-=n),(A.d>=O||A.ArrowRight>=O)&&(t+=n),{pos_x:t,pos_y:e,key_z:A.z>=O,key_x:A.x==N,key_c:A.c==N}}();if(!c&&(a.U.updateState(i),!c))for(var v=0;v<g;v++)t.update();r.clear();var m=new u.l;m.bind(n),s.io(m),m.flush(),t.render(),r.setMode(0),m.bind(e),s.ax(m),m.flush()}}(),function(){for(var t in A)3==A[t]&&(A[t]=2),1==A[t]&&(A[t]=0)}(),I&&requestAnimationFrame(R)}const O=2,N=3;window.onload=async function(){console.log("window loaded"),T(),console.log("canvas setup"),await i.S(),console.log("stage initialized"),__webpack_require__(235),P(),window.debug_info.stg={fps:x,init:i.S,start:P,terminate:S},window.debug_info.platform=t}})()})();