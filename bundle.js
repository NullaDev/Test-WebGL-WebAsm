(()=>{var t={235:()=>{const t=document.getElementById("stage_start"),n=document.getElementById("stage_dec"),e=document.getElementById("stage_inc"),i=document.getElementById("ability_set"),r=document.getElementById("ability_dec"),o=document.getElementById("ability_inc"),a=debug_info.stage,s=()=>{n.disabled=0==a.stage,e.disabled=a.stage==a.stage_list.length-1,t.value=`${a.stage_list[a.stage].name}`,r.disabled=0==a.ability,o.disabled=a.ability==a.ability_list.length-1,i.value=`${a.ability_list[a.ability].name}`,a.scale=a.stage_list[a.stage].default_scale};n.onclick=()=>{a.stage--,s()},e.onclick=()=>{a.stage++,s()},r.onclick=()=>{a.ability--,s()},o.onclick=()=>{a.ability++,s()},s()}},n={};function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{}};return t[i](r,r.exports,e),r.exports}e.d=(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};e.r(t),e.d(t,{clear:()=>N,draw:()=>P,drawRects:()=>F,drawSnake:()=>j,global_gl:()=>A,loadImage:()=>T,loadTexture:()=>S,setMode:()=>I,setup:()=>E});var n={};e.r(n),e.d(n,{ability_invinc:()=>Mt,ability_slow:()=>vt,ability_small:()=>It,ability_stop:()=>gt});var i={};e.r(i),e.d(i,{stage_000:()=>Ht,stage_001:()=>Vt,stage_002:()=>Wt,stage_003:()=>Qt,stage_004:()=>Zt,stage_005:()=>tn,stage_006:()=>nn,test_000:()=>en,test_001:()=>rn,test_002:()=>pn});var r={};e.r(r),e.d(r,{KEY_CLICK:()=>Bn,KEY_PRESS:()=>jn,canvas_height:()=>xn,canvas_width:()=>gn,container:()=>Ln,devicePixelRatio:()=>En,keys:()=>Nn,last_update_rate:()=>In,mainloop_start:()=>Un,mainloop_terminate:()=>Fn,mouse:()=>Sn,setup_canvas:()=>Rn,test_fps:()=>Tn});var o,a,s=(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)},function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),u=function(){},c=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return s(n,t),n}(u),h=function(t){function n(n){var e=t.call(this)||this;return e.radius=n,e}return s(n,t),n.prototype.exitScreen=function(t){var n=Math.sqrt(Math.pow(t.shaped_sprite.w,2)+Math.pow(t.shaped_sprite.h,2));return Math.max(0,n*t.magn)},n.prototype.distanceTo=function(t,n,e){return Math.sqrt(Math.pow(n-t.px,2)+Math.pow(e-t.py,2))-this.radius*t.magn},n.prototype.rawDistanceTo=function(t,n,e,i,r){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-n,2))-this.radius*e},n.prototype.rawExitScreen=function(t,n,e,i,r){var o=Math.sqrt(Math.pow(e.w,2)+Math.pow(e.h,2));return Math.abs(t)>i+o||Math.abs(n)>r+o},n}(c),p=function(t){function n(n,e){var i=t.call(this)||this;return i.len=n,i.rad=e,i}return s(n,t),n.orthDis=function(t,n,e,i){var r=i/2;t=Math.abs(t);var o=e*e/r/2+r/2-r;return(n=Math.abs(n))>=0&&e*(n+o)>t*o?Math.sqrt(Math.pow(t,2)+Math.pow(n+o,2))-o-r:Math.sqrt(Math.pow(t-e,2)+Math.pow(n,2))-r},n.prototype.exitScreen=function(t){return Math.sqrt(Math.pow(t.shaped_sprite.w,2)+Math.pow(t.shaped_sprite.h,2))*t.magn},n.prototype.distanceTo=function(t,e,i){var r=e-t.px,o=i-t.py,a=r*Math.cos(-t.dir)-o*Math.sin(-t.dir),s=r*Math.sin(-t.dir)+o*Math.cos(-t.dir);return n.orthDis(a,s,this.len/2*t.magn,this.rad*t.magn)},n}(c),l=function(){},f=(s((function(){return null!==a&&a.apply(this,arguments)||this}),a=l),function(){function t(t,n){this.collideCheck=null,this.renderType=t,this.shaped_sprite=n}return t.prototype.distanceTo=function(t,n){var e;return(null===(e=this.shaped_sprite)||void 0===e?void 0:e.shape)?this.shaped_sprite.shape.distanceTo(this,t,n):1/0},t}()),d=function(t){function n(n){var e=t.call(this,0,n)||this;return e.magn=1,e.alpha=1,e}return s(n,t),n.prototype.rectCount=function(){return 1},n.prototype.render=function(t,n){t[10*n+0]=this.px,t[10*n+1]=this.py,t[10*n+2]=this.dir+Math.PI/2,t[10*n+3]=this.shaped_sprite.w/2*this.magn,t[10*n+4]=this.shaped_sprite.h/2*this.magn;var e=this.shaped_sprite.sprite;t[10*n+5]=e.tx/e.sprite.w,t[10*n+6]=e.ty/e.sprite.h,t[10*n+7]=e.tw/e.sprite.w,t[10*n+8]=e.th/e.sprite.h,t[10*n+9]=this.alpha},n}(f),y=function(t){function n(){return t.call(this,null,null)||this}return s(n,t),n}(f);function _(t,n){if(t.collideCheck)return t.collideCheck(n);if(n.collideCheck)return n.collideCheck(t);if(t instanceof d&&t.shaped_sprite.shape instanceof h)return n.distanceTo(t.px,t.py)<t.shaped_sprite.shape.radius;if(n instanceof d&&n.shaped_sprite.shape instanceof h)return _(n,t);throw new Error("non-circle non-circle collision not found")}var v=192,m=224,w=360,g=240;function x(t){return t/w}function b(t){return t/g}var M=1/64,A={gl:null,shader:{program:0,attribute:{coord:0,tex:0,alpha:0},uniform:{uSampler:0}}};function E(){var t=document.getElementById("glcanvas"),n=t.getContext("webgl");if(null!==n){A.gl=n;var e=n.createShader(n.VERTEX_SHADER),i=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(e,"\nattribute vec2 coord;\nattribute vec2 tex;\nattribute float alpha;\nvarying highp vec2 vTexCoord;\nvarying highp float vTexAlpha;\nvoid main() {\n    gl_Position = vec4(coord, 0.0, 1.0);\n    vTexCoord = tex;\n    vTexAlpha = alpha;\n}\n"),n.shaderSource(i,"\nprecision highp float;\nvarying highp vec2 vTexCoord;\nvarying highp float vTexAlpha;\nuniform sampler2D uSampler;\nvoid main() {\n    vec4 col = texture2D(uSampler, vTexCoord);\n    col.a *= vTexAlpha;\n    col.rgb *= col.a;\n    gl_FragColor = col;\n}\n"),n.compileShader(e),n.compileShader(i);var r=n.createProgram();n.attachShader(r,e),n.attachShader(r,i),n.linkProgram(r),n.useProgram(r);var o=A.shader;o.program=r,o.attribute.coord=n.getAttribLocation(r,"coord"),o.attribute.tex=n.getAttribLocation(r,"tex"),o.attribute.alpha=n.getAttribLocation(r,"alpha"),o.uniform.uSampler=n.getUniformLocation(r,"uSampler"),n.enable(n.BLEND),n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD),n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),n.disable(n.DEPTH_TEST),n.viewport(0,0,t.width,t.height)}else alert("Unable to initialize WebGL. Your browser or machine may not support it.")}function I(t){var n=A.gl;0==t?n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA):n.blendFuncSeparate(n.ONE,n.ONE,n.ONE,n.ONE_MINUS_SRC_ALPHA)}function T(t){return new Promise((function(n,e){var i=new Image;i.onload=function(){return n(i)},i.onerror=e,i.src=t}))}function P(t,n,e,i,r){var o=A.gl,a=o.createBuffer(),s=A.shader.attribute.coord;o.bindBuffer(o.ARRAY_BUFFER,a),o.bufferData(o.ARRAY_BUFFER,t,o.STATIC_DRAW),o.vertexAttribPointer(s,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(s);var u=o.createBuffer(),c=A.shader.attribute.tex;o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,n,o.STATIC_DRAW),o.vertexAttribPointer(c,2,o.FLOAT,!1,0,0),o.enableVertexAttribArray(c);var h=o.createBuffer(),p=A.shader.attribute.alpha;o.bindBuffer(o.ARRAY_BUFFER,h),o.bufferData(o.ARRAY_BUFFER,e,o.STATIC_DRAW),o.vertexAttribPointer(p,1,o.FLOAT,!1,0,0),o.enableVertexAttribArray(p),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,i),o.uniform1i(A.shader.uniform.uSampler,0),o.drawArrays(o.TRIANGLES,0,r)}function S(t,n,e){void 0===n&&(n=!0),void 0===e&&(e=!1);var i=A.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.bindTexture(i.TEXTURE_2D,r),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_SHORT_4_4_4_4,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e?i.REPEAT:i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e?i.REPEAT:i.CLAMP_TO_EDGE),r}function N(){var t=A.gl;t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.clearColor(0,0,1,1)}var R=[-1,-1,1,-1,1,1],k=[-1,1,1,-1,-1,1],O=[0,0,1,0,1,1],C=[0,1,1,0,0,1];function U(t){for(var n=0;n<t.length/2;n++)t[2*n]=x(t[2*n]),t[2*n+1]=b(t[2*n+1])}function F(t,n,e){for(var i=new Float32Array(12*n),r=new Float32Array(12*n),o=new Float32Array(6*n),a=0;a<n;a++)for(var s=0;s<6;s++){var u=t[10*a+2],c=t[10*a+3]*R[s],h=t[10*a+4]*k[s];i[12*a+2*s+0]=t[10*a+0]+c*Math.cos(u)-h*Math.sin(u),i[12*a+2*s+1]=t[10*a+1]+c*Math.sin(u)+h*Math.cos(u),r[12*a+2*s+0]=t[10*a+5]+O[s]*t[10*a+7],r[12*a+2*s+1]=t[10*a+6]+C[s]*t[10*a+8],o[6*a+s]=t[10*a+9]}U(i),P(i,r,o,e,6*n)}function D(t,n,e,i,r,o,a,s,u,c){var h=2*n+4*i,p=2*n+8*(e-1)-4*(i+1);t[h+0]=a,t[h+1]=s,t[p+0]=u,t[p+1]=c,0==i?(h>0&&(t[h-2]=a,t[h-1]=s),t[p+2]=t[h+0],t[p+3]=t[h+1],t[p+4]=t[h+0],t[p+5]=t[h+1]):i==e-2?(t[h-2]=r,t[h-1]=o,t[p+2]=r,t[p+3]=o,t[h+2]=t[p+0],t[h+3]=t[p+1]):(t[h-2]=r,t[h-1]=o,t[p+2]=r,t[p+3]=o)}function j(t,n,e){for(var i=n.reduce((function(t,n){return n.len.reduce((function(t,n){return t+4*(n-1)+2}),t)}),0),r=new Float32Array(2*i),o=new Float32Array(2*i),a=new Float32Array(i),s=new Float32Array(n.reduce((function(t,n){return n.len.reduce((function(t,n){return Math.max(t,n)}),t)}),0)),u=0,c=0,h=0,p=n;h<p.length;h++)for(var l=p[h],f=0,d=l.len;f<d.length;f++){for(var y=d[f],_=0,v=0;v<y-1;v++){var m=t[2*u+2*v],w=t[2*u+2*v+1],g=t[2*u+2*v+2],x=t[2*u+2*v+3],b=(m+g)/2,M=(w+x)/2,E=Math.sqrt((g-m)*(g-m)+(x-w)*(x-w));s[v]=E,_+=E,D(r,c,y,v,m,w,b-(M-w)/E*l.w,M+(b-m)/E*l.w,b+(M-w)/E*l.w,M-(b-m)/E*l.w)}_-=s[0]/2+s[y-2]/2;var I=-s[0]/2;for(v=0;v<y-1;v++)D(o,c,y,v,l.tx+l.tw*I/_,l.ty+l.th/2,l.tx+l.tw*(I+s[v]/2)/_,l.ty,l.tx+l.tw*(I+s[v]/2)/_,l.ty+l.th),I+=s[v];u+=y,c+=4*(y-1)+2}for(v=0;v<i;v++)a[v]=1;U(r);var T=A.gl,P=T.createBuffer(),S=A.shader.attribute.coord;T.bindBuffer(T.ARRAY_BUFFER,P),T.bufferData(T.ARRAY_BUFFER,r,T.STATIC_DRAW),T.vertexAttribPointer(S,2,T.FLOAT,!1,0,0),T.enableVertexAttribArray(S);var N=T.createBuffer(),R=A.shader.attribute.tex;T.bindBuffer(T.ARRAY_BUFFER,N),T.bufferData(T.ARRAY_BUFFER,o,T.STATIC_DRAW),T.vertexAttribPointer(R,2,T.FLOAT,!1,0,0),T.enableVertexAttribArray(R);var k=T.createBuffer(),O=A.shader.attribute.alpha;T.bindBuffer(T.ARRAY_BUFFER,k),T.bufferData(T.ARRAY_BUFFER,a,T.STATIC_DRAW),T.vertexAttribPointer(O,1,T.FLOAT,!1,0,0),T.enableVertexAttribArray(O),T.activeTexture(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,e),T.uniform1i(A.shader.uniform.uSampler,0),T.drawArrays(T.TRIANGLE_STRIP,0,i-2)}var B=function(){function t(t){this.img=null,this.path=t}return t.prototype.loaded=function(){return this.img},t.prototype.load=function(){return t=this,n=void 0,i=function(){var t;return function(t,n){var e,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(t,a)}catch(t){o=[6,t],i=0}finally{e=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(n){switch(n.label){case 0:return[4,T(this.path)];case 1:return t=n.sent(),this.img=S(t),[2]}}))},new((e=void 0)||(e=Promise))((function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,s)}u((i=i.apply(t,n||[])).next())}));var t,n,e,i},t.get=function(n){return t.INS[n]?t.INS[n]:t.INS[n]=new t(n)},t.prototype.draw=function(t){this.drawRect(t,0),this.drawRect(t,1),this.drawCurve(t,0),this.drawCurve(t,1)},t.prototype.drawRect=function(t,n){var e=t.reduce((function(t,e){return 0==e.renderType&&e.shaped_sprite.sprite.mode==n?t+e.rectCount():t}),0);if(e){I(n);for(var i=new Float32Array(10*e),r=0,o=0,a=t;o<a.length;o++){var s=a[o];if(0==s.renderType&&s.shaped_sprite.sprite.mode==n){var u=s;u.render(i,r),r+=u.rectCount()}}F(i,e,this.img)}},t.prototype.drawCurve=function(t,n){var e=t.filter((function(t){return 1==t.renderType&&t.shaped_sprite.sprite.mode==n})).map((function(t){return t.preRender()})),i=e.reduce((function(t,n){return n.list.reduce((function(t,n){return n.len<=1?t:t+n.len}),t)}),0);if(0!=i){I(n);for(var r=new Float32Array(2*i),o=0,a=0,s=e;a<s.length;a++)for(var u=s[a],c=0,h=u.list;c<h.length;c++){var p=h[c];if(!(p.len<=1))for(var l=0;l<p.len;l++)r[o++]=u.curve.list[l+p.start].px,r[o++]=u.curve.list[l+p.start].py}j(r,e.map((function(t){return{w:t.curve.shaped_sprite.sp_w,len:t.list.map((function(t){return t.len})).filter((function(t){return t>1})),tx:t.curve.shaped_sprite.sprite.tx/t.curve.shaped_sprite.sprite.sprite.w,ty:t.curve.shaped_sprite.sprite.ty/t.curve.shaped_sprite.sprite.sprite.h,tw:t.curve.shaped_sprite.sprite.tw/t.curve.shaped_sprite.sprite.sprite.w,th:t.curve.shaped_sprite.sprite.th/t.curve.shaped_sprite.sprite.sprite.h}})).filter((function(t){return t.len.length>0})),this.img)}},t.INS={},t}();function L(t){return Object.assign({},t)}var z={render_layer:700,collide_group:0,collide_mask:0},q=function(){function t(){this.time_rate=1,this.list=[]}return t.prototype.process=function(){this.time_rate=this.list.reduce((function(t,n){return t*n.rate}),1),this.list=this.list.filter((function(t){return--t.duration>0}))},t.prototype.time_slowdown=function(t,n){this.list.push({rate:t,duration:n})},t}(),X=function(){function t(){this.groups=[],this.pending=[],this.update_stage=0,this.time=0,this.special_effects=new q,t.INSTANCE=this,this.groups.push({id:0,mask:0,list:[]}),this.groups.push({id:1,mask:1,list:[]}),this.groups.push({id:2,mask:1,list:[]}),this.groups.push({id:3,mask:1,list:[]}),this.groups.push({id:4,mask:14,list:[]}),this.groups.push({id:5,mask:0,list:[]})}return t.prototype.registerGroup=function(t){var n=this.groups.length;return this.groups.push({id:n,mask:t,list:[]}),n},t.prototype.add=function(t){3!=this.update_stage&&0!=this.update_stage?this.pending.push(t):this.groups[t.config.collide_group].list.push(t)},t.prototype.update=function(){var t=this;this.update_stage=1,this.groups.forEach((function(t){return t.list.forEach((function(t){return t.update(t)}))}));for(var n=0;n<this.groups.length;n++)for(var e=0;e<this.groups.length;e++)if(this.groups[n].mask&1<<e)for(var i=0,r=this.groups[n].list;i<r.length;i++){var o=r[i];if(1==o.state&&o.shaped_sprite&&o.shaped_sprite.shape)for(var a=0,s=this.groups[e].list;a<s.length;a++){var u=s[a];1==u.state&&u.shaped_sprite&&u.shaped_sprite.shape&&_(o,u)&&o.attack(o,u)}}this.update_stage=2,this.groups.forEach((function(t){return t.list.forEach((function(t){return t.postUpdate(t)}))})),this.groups.forEach((function(t){return t.list=t.list.filter((function(t){return 3!=t.state}))})),this.update_stage=3,this.special_effects.process(),this.pending.forEach((function(n){return t.add(n)})),this.pending=[],this.time++},t.prototype.render=function(){var t,n,e,i,r,o,a,s;return r=this,o=void 0,s=function(){var r,o,a,s,u,c,h,p,l,f,d,y;return function(t,n){var e,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(t,a)}catch(t){o=[6,t],i=0}finally{e=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(_){for(r=new Map,o=[],a=0,s=this.groups;a<s.length;a++)for(u=s[a],c=0,h=u.list;c<h.length;c++)2!=(p=h[c]).renderType?p.config.render_layer&&(null===(t=p.shaped_sprite)||void 0===t?void 0:t.sprite)&&(r.has(p.config.render_layer)||r.set(p.config.render_layer,new Map),f=r.get(p.config.render_layer),d=null===(i=null===(e=null===(n=p.shaped_sprite)||void 0===n?void 0:n.sprite)||void 0===e?void 0:e.sprite)||void 0===i?void 0:i.path,f.has(d)||f.set(d,[]),f.get(d).push(p)):(l=p,o.push(l),l.layers().forEach((function(t){return r.set(t,new Map)})));return y=[],r.forEach((function(t,n){return y.push({rl:n,v:t})})),y.sort((function(t,n){return t.rl-n.rl})),y.forEach((function(t){o.forEach((function(n){return n.render(t.rl)})),t.v.forEach((function(t,n){return B.get(n).draw(t)}))})),[2]}))},new((a=void 0)||(a=Promise))((function(t,n){function e(t){try{u(s.next(t))}catch(t){n(t)}}function i(t){try{u(s.throw(t))}catch(t){n(t)}}function u(n){var r;n.done?t(n.value):(r=n.value,r instanceof a?r:new a((function(t){t(r)}))).then(e,i)}u((s=s.apply(r,o||[])).next())}))},t}(),Y=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),G=function(){function t(t,n,e){this.shoot=t,this.bomb=n,this.ability=e}return t.prototype.updateShoot=function(t,n){var e;null===(e=this.shoot)||void 0===e||e.updateEnable(t,n)},t.prototype.updateBomb=function(t,n){var e;return null===(e=this.bomb)||void 0===e?void 0:e.updateEnable(t,n)},t.prototype.updateAbility=function(t,n){var e;return null===(e=this.ability)||void 0===e?void 0:e.updateEnable(t,n)},t.prototype.render=function(t,n){var e,i,r;null===(e=this.shoot)||void 0===e||e.render(t,n),null===(i=this.bomb)||void 0===i||i.render(t,n),null===(r=this.ability)||void 0===r||r.render(t,n)},t.prototype.layers=function(){var t=[];return this.shoot&&(t=t.concat(this.shoot.layers())),this.bomb&&(t=t.concat(this.bomb.layers())),this.ability&&(t=t.concat(this.ability.layers())),t},t}(),H=function(t){function n(e,i,r,o,a){var s=t.call(this,2,null)||this;return s.config=z,s.state=1,s.time=0,s.missed=!1,s.bombed=0,s.grazed=!1,s.post_grazed=!1,s.pre_miss=0,s.miss_time=0,s.invince_time=0,s.px=0,s.py=0,s.dir=0,s.prex=0,s.prey=0,s.graze_total=0,s.graze_current=0,s.magn=1,s.collideCheck=function(t){for(var n=Math.sqrt(Math.pow(s.px-s.prex,2)+Math.pow(s.py-s.prey,2)),e=Math.max(1,Math.ceil(n/2)),i=1/0,r=0;r<e;r++){var o=s.px+(s.prex-s.px)*r/e,a=s.py+(s.prey-s.py)*r/e;i=Math.min(i,t.distanceTo(o,a))}var u=s.sprite.shape.radius*s.ability.radius*s.magn;return i-u<s.ability.graze_radius&&(s.grazed=!0),i<u},n.INSTANCE=s,s.proto=i,s.ability=r,s.sprite=e,s.px=o,s.py=a,s.dir=0,s.bomb_count=r.init_bomb,s.life_count=r.init_life,s.ability_count=r.init_ability,s.renderType=2,s}return Y(n,t),n.updateState=function(t){n.action=t},n.prototype.update=function(t){if(n.action){this.prex=this.px,this.prey=this.py;var e=X.INSTANCE.special_effects.time_rate;this.time+=e,this.px+=n.action.pos_x,this.py+=n.action.pos_y,this.px<-192&&(this.px=-192),this.px>v&&(this.px=v),this.py<-224&&(this.py=-224),this.py>m&&(this.py=m),this.dir=this.time*this.sprite.sprite.omega,this.proto.updateShoot(this,n.action.key_z),this.bombed=this.proto.updateBomb(this,n.action.key_x),this.bombed||(this.bombed=this.proto.updateAbility(this,n.action.key_c))}},n.prototype.postUpdate=function(t){this.post_grazed=this.grazed,this.grazed&&(this.graze_current<this.ability.max_graze&&(this.graze_current+=X.INSTANCE.special_effects.time_rate),this.graze_total++,this.graze_current>=this.ability.max_graze&&this.ability_count<this.ability.max_ability&&(this.ability_count++,this.graze_current=0),this.grazed=!1),this.miss_time>0&&this.miss_time--,this.pre_miss>0&&(this.pre_miss--,0==this.pre_miss&&(console.log("missed"),this.miss_time=this.ability.miss_time)),this.missed&&(this.missed=!1,this.pre_miss=this.ability.pre_miss),this.bombed&&(this.miss_time=this.bombed,this.bombed=0,this.pre_miss>0&&(console.log("bomb after miss"),this.pre_miss=0)),this.miss_time>0||this.pre_miss>0?(this.state=2,this.invince_time++,Math.floor(this.invince_time/6)%2==0?this.shaped_sprite=null:this.shaped_sprite=this.sprite):(this.state=1,this.invince_time=0,this.shaped_sprite=this.sprite)},n.prototype.attack=function(t,n){},n.prototype.damaged=function(t,n){return 0==this.pre_miss&&0==this.miss_time&&(this.missed=!0),n.damaged(n,this)},n.prototype.layers=function(){return function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var i=Array(t),r=0;for(n=0;n<e;n++)for(var o=arguments[n],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i}(this.proto.layers(),[700])},n.prototype.render=function(t){var n,e=[],i=0,r=null;this.proto.render(t,this),700==t&&(null===(n=this.shaped_sprite)||void 0===n?void 0:n.sprite)&&(function(t,n,o,a,s){e.push(t),e.push(n),e.push(o+Math.PI/2),e.push(s.w/2),e.push(s.h/2);var u=s.sprite;e.push(u.tx/u.sprite.w),e.push(u.ty/u.sprite.h),e.push(u.tw/u.sprite.w),e.push(u.th/u.sprite.h),e.push(1),i++,r=B.get(u.sprite.path).img}(this.px,this.py,this.dir,0,this.shaped_sprite),I(0),F(new Float32Array(e),i,r))},n.INSTANCE=null,n.action=null,n}(f),V=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),W=function(t){function n(n){var e=t.call(this)||this;return e.func=n,e}return V(n,t),n.prototype.distanceTo=function(t,n,e){return Math.min(this.func(t,n,e),t.shaped_sprite.base.shape.rawDistanceTo(t.px,t.py,1,n,e),t.shaped_sprite.end.shape.rawDistanceTo(t.px+t.len*Math.cos(t.dir),t.py+t.len*Math.sin(t.dir),1,n,e))},n.line_circle=function(t,n,e){var i=t.px+t.shaped_sprite.hitbox_width*Math.cos(t.dir),r=t.py+t.shaped_sprite.hitbox_width*Math.sin(t.dir),o=t.px+(t.len-t.shaped_sprite.hitbox_width)*Math.cos(t.dir),a=t.py+(t.len-t.shaped_sprite.hitbox_width)*Math.sin(t.dir),s=Math.sqrt(Math.pow(i-o,2)+Math.pow(r-a,2)),u=Math.abs((o-i)*(r-e)-(i-n)*(a-r)),c=Math.sqrt(Math.pow(i-n,2)+Math.pow(r-e,2)),h=Math.sqrt(Math.pow(o-n,2)+Math.pow(a-e,2));return Math.pow(Math.max(c,h),2)>Math.pow(Math.min(c,h),2)+Math.pow(s,2)?Math.min(c,h)-t.shaped_sprite.hitbox_width*t.w:Math.min(u/s,c,h)-t.shaped_sprite.hitbox_width*t.w},n.double_arc=function(t,n,e){var i=n-t.px,r=e-t.py,o=i*Math.cos(-t.dir)-r*Math.sin(-t.dir),a=i*Math.sin(-t.dir)+r*Math.cos(-t.dir);return p.orthDis(o-t.len/2,a,t.len/2,t.w*t.shaped_sprite.hitbox_width)},n.half_arc=function(t,n,e){var i=n-t.px,r=e-t.py,o=i*Math.cos(-t.dir)-r*Math.sin(-t.dir),a=i*Math.sin(-t.dir)+r*Math.cos(-t.dir);return o<0?Math.sqrt(Math.pow(o,2)+Math.pow(a,2)):p.orthDis(o,a,t.len,t.w*t.shaped_sprite.hitbox_width)},n}(u),K=(function(t){V((function(){return null!==t&&t.apply(this,arguments)||this}),t)}(l),function(t){function n(n,e,i){var r=t.call(this,n)||this;return r.state=0,r.rstate=0,r.time=0,r.custom_fields={},r.config=e,r.motion=i,r}return V(n,t),n.prototype.init=function(t,n,e,i){return this.len=i,this.dir=e,this.px=t,this.py=n,this.checkState(),this},n.prototype.checkState=function(){var t,n,e,i,r,o,a,s,u,c,h=this;0==this.state&&(this.state=2,null===(n=null===(t=this.config.listener)||void 0===t?void 0:t.onInit)||void 0===n||n.forEach((function(t){return t(h)})));var p=this.config.warning_time,l=this.config.open_time+p,f=this.config.alive_time+l,d=this.config.close_time+f;0==this.rstate&&this.time>=p&&(this.rstate=1,null===(i=null===(e=this.config.listener)||void 0===e?void 0:e.onStateChange)||void 0===i||i.forEach((function(t){return t(h)}))),1==this.rstate&&(this.w=Math.min(1,(this.time-p)/(l-p)),this.time>=l&&(this.rstate=2,this.state=1,this.w=1,null===(o=null===(r=this.config.listener)||void 0===r?void 0:r.onStateChange)||void 0===o||o.forEach((function(t){return t(h)})))),2==this.rstate&&this.time>=f&&(this.rstate=3,this.state=2,null===(s=null===(a=this.config.listener)||void 0===a?void 0:a.onStateChange)||void 0===s||s.forEach((function(t){return t(h)}))),3==this.rstate&&(this.w=Math.max(0,1-(this.time-f)/(d-f)),this.time>=d&&(this.state=3,null===(c=null===(u=this.config.listener)||void 0===u?void 0:u.onDestroy)||void 0===c||c.forEach((function(t){return t(h)}))))},n.prototype.update=function(t){var n,e,i,r,o,a,s=this;0==this.state&&(this.state=2,null===(e=null===(n=this.config.listener)||void 0===n?void 0:n.onInit)||void 0===e||e.forEach((function(t){return t(s)})));var u=X.INSTANCE.special_effects.time_rate;this.time+=u,this.checkState(),null===(r=null===(i=this.config.listener)||void 0===i?void 0:i.onUpdate)||void 0===r||r.forEach((function(t){return t(s,u)})),this.motion(this,u),null===(a=null===(o=this.config.listener)||void 0===o?void 0:o.onPostMotion)||void 0===a||a.forEach((function(t){return t(s,u)}))},n.prototype.postUpdate=function(t){var n,e,i=this;null===(e=null===(n=this.config.listener)||void 0===n?void 0:n.onPostUpdate)||void 0===e||e.forEach((function(t){return t(i)}))},n.prototype.attack=function(t,n){var e,i,r=this;null===(i=null===(e=this.config.listener)||void 0===e?void 0:e.onAttack)||void 0===i||i.forEach((function(t){return t(r,n)})),n.damaged(n,this)},n.prototype.damaged=function(t,n){var e,i,r=this;return null===(i=null===(e=this.config.listener)||void 0===e?void 0:e.onContact)||void 0===i||i.forEach((function(t){return t(r,n)})),!1},n}(function(t){function n(n){var e=t.call(this,0,n)||this;return e.w=0,e}return V(n,t),n.prototype.rectCount=function(){return 3},n.prototype.render=function(t,n){var e=this.shaped_sprite.l_ratio*this.len/2;t[10*n+0]=this.px+e*Math.cos(this.dir),t[10*n+1]=this.py+e*Math.sin(this.dir),t[10*n+2]=this.dir+Math.PI/2,t[10*n+3]=Math.max(1,this.shaped_sprite.sprite_width*this.w),t[10*n+4]=e;var i=this.shaped_sprite.sprite;t[10*n+5]=i.tx/i.sprite.w,t[10*n+6]=i.ty/i.sprite.h,t[10*n+7]=i.tw/i.sprite.w,t[10*n+8]=i.th/i.sprite.h,t[10*n+9]=1,n++;var r=this.shaped_sprite.base;t[10*n+0]=this.px,t[10*n+1]=this.py,t[10*n+2]=this.dir+Math.PI/2,t[10*n+3]=r.w/2,t[10*n+4]=r.h/2,i=r.sprite,t[10*n+5]=i.tx/i.sprite.w,t[10*n+6]=i.ty/i.sprite.h,t[10*n+7]=i.tw/i.sprite.w,t[10*n+8]=i.th/i.sprite.h,t[10*n+9]=1,n++,r=this.shaped_sprite.end,t[10*n+0]=this.px+this.len*Math.cos(this.dir),t[10*n+1]=this.py+this.len*Math.sin(this.dir),t[10*n+2]=this.dir+Math.PI/2,t[10*n+3]=r.w/2,t[10*n+4]=r.h/2,i=r.sprite,t[10*n+5]=i.tx/i.sprite.w,t[10*n+6]=i.ty/i.sprite.h,t[10*n+7]=i.tw/i.sprite.w,t[10*n+8]=i.th/i.sprite.h,t[10*n+9]=1},n}(f))),$=[0,0,1,1,0,0,0,0,0,1,1,1,1,0,0],J=[1,1,1,0,0,0,1,0],Q=2*Math.PI/600,Z={path:"assets/bullet_000.png",w:516,h:772};function tt(t){return t.tx+=.5,t.ty+=.5,t.tw-=1,t.th-=1,t}function nt(t,n,e){return tt({sprite:Z,tx:t<12?1+16*n:t<14?1+n%8*8:t<15?1:258+16*n,ty:t<12?1+16*t:t<14?(t<13?193:241)+8*(n>>3):n<15?515+16*n:449,tw:t<12?16:t<14?8:t<15?256:16,th:t<12?16:t<14?8:16,mode:e,category:1,type:t,color:n,omega:$[t]*Q})}function et(t,n,e){return tt({sprite:Z,tx:(t<7?1:258)+32*n,ty:0==t?209:t<7?226+32*t:257,tw:32,th:32,mode:e,category:2,type:t,color:n,omega:J[t]*Q})}function it(t,n,e){return tt({sprite:Z,tx:(0==t?1:258)+64*n,ty:0==t?449:290,tw:64,th:64,mode:e,category:3,type:t,color:n,omega:Q})}var rt=tt({sprite:Z,tx:258,ty:17,tw:64,th:64,mode:0,category:0,type:0,color:0,omega:Q}),ot=(tt({sprite:Z,tx:322,ty:17,tw:64,th:64,mode:0,category:0,type:1,color:0,omega:Q}),tt({sprite:Z,tx:386,ty:81,tw:128,th:128,mode:0,category:0,type:2,color:0,omega:Q})),at=[[Math.sqrt(27),0],[2.4,2.4,4,4,2.4,2.4,2.4,2.8,2.4,2.4,4,2.4,2.4,2.4,2.4,2.4],[6,7,8.5,7,6,7,0,10],[14,14]],st=.75;function ut(t){return Math.sqrt(Math.pow(t,2)+Math.pow(3,2))-3}function ct(t,n){return n*=st,{sprite:t,shape:new h(ut(at[t.category][t.type])*n),w:t.tw*n,h:t.th*n,renderType:0}}function ht(t,n,e,i,r,o,a){var s=nt(t,n,i);return s.ty+=0==t?4:4==t||1==t?1:NaN,s.th-=0==t?8:4==t?2:1==t?1:NaN,{sprite:s,shape:new W(0==t?W.line_circle:1==t?W.half_arc:4==t?W.double_arc:null),renderType:0,sprite_width:s.tw*st/2*a,hitbox_width:ut(2.4)*st*a,l_ratio:0==t||o>0?1:4==t?1.15:1==t?1.2:NaN,base:ct(et(0,e,i),r*a),end:ct(et(0,e,i),o*a)}}var pt=function(){function t(){this.ver=[],this.tex=[],this.alp=[],this.n=0}return t.prototype.bind=function(t){this.img=t},t.prototype.rect=function(t,n){var e,i,r=t[0],o=t[1],a=t[2],s=t[3],u=[r,o,r,o+s,r+a,o,r,o+s,r+a,o,r+a,o+s];(e=this.ver).push.apply(e,u),(i=this.tex).push.apply(i,u.map((function(t){return t*n}))),this.alp.push(1,1,1,1,1,1),this.n+=6},t.prototype.fan=function(t,n){for(var e=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],h=t[8],p=t[9],l=t[10],f=Math.ceil(Math.abs(e)/(2*Math.PI)*n),d=function(t,n,e,i,r,o,a){return t.push(n,e,n+i*Math.cos(o),e+r*Math.sin(o),n+i*Math.cos(a),e+r*Math.sin(a))},y=0;y<f;y++)d(this.ver,r,o,a,a,i+e/f*y,i+e/f*(y+1)),d(this.tex,u,c,h,p,s+e/f*y,s+e/f*(y+1)),this.alp.push(l,l,l);this.n+=3*f},t.prototype.flush=function(){for(var t=new Float32Array(this.ver),n=0;n<t.length;n+=2)t[n]=x(t[n]),t[n+1]=b(t[n+1]);P(t,new Float32Array(this.tex),new Float32Array(this.alp),this.img,this.n),this.ver=[],this.tex=[],this.alp=[],this.n=0},t}(),lt=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var i=Array(t),r=0;for(n=0;n<e;n++)for(var o=arguments[n],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i},ft=ct(ot,1),dt=function(){function t(t){this.special_duration=t,this.special_remain=0}return t.prototype.updateEnable=function(t,n){return this.special_remain>0&&(this.special_remain--,this.update(t)),this.special_remain>0?0:n&&t.ability_count>0&&this.onActivate(t)?(t.ability_count--,this.special_remain=this.special_duration,0):0},t.prototype.render=function(t,n){if(150==t){var e=new pt;I(0);var i=ft.sprite,r=[(i.tx+i.tw/2)/i.sprite.w,(i.ty+i.th/2)/i.sprite.h,i.tw/2/i.sprite.w,i.th/2/i.sprite.h];if(e.bind(B.get(i.sprite.path).img),0==this.special_remain){var o=2*Math.PI*n.ability_count/(n.ability.max_ability+1),a=2*Math.PI*(n.graze_current/n.ability.max_graze)/(n.ability.max_ability+1),s=n.post_grazed?.7:.5,u=n.graze_current==n.ability.max_graze?s:n.post_grazed?.7:.2;e.fan(lt([o,Math.PI/2,n.px,n.py,ft.w/2,Math.PI/6],r,[s]),32),e.fan(lt([a,Math.PI/2+o,n.px,n.py,ft.w/2,Math.PI/6+o],r,[u]),32)}else o=2*Math.PI*this.special_remain/this.special_duration,e.fan(lt([o,-o+Math.PI/2,n.px,n.py,ft.w/2,-o+Math.PI/6],r,[1]),32);e.flush()}},t.prototype.layers=function(){return[150]},t}(),yt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),_t=function(t){function n(){return t.call(this,240)||this}return yt(n,t),n.prototype.update=function(){},n.prototype.onActivate=function(){return X.INSTANCE.special_effects.time_slowdown(.5,240),!0},n}(dt),vt={name:"slow",init:function(){return new _t}},mt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),wt=function(t){function n(){return t.call(this,120)||this}return mt(n,t),n.prototype.update=function(){},n.prototype.onActivate=function(){return X.INSTANCE.special_effects.time_slowdown(0,120),!0},n}(dt),gt={name:"stop",init:function(){return new wt}},xt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),bt=function(t){function n(){return t.call(this,30)||this}return xt(n,t),n.prototype.update=function(t){t.magn=this.special_remain>0?-1/0:1},n.prototype.onActivate=function(){return!0},n}(dt),Mt={name:"invincibility",init:function(){return new bt}},At=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Et=function(t){function n(){return t.call(this,300)||this}return At(n,t),n.prototype.update=function(t){t.magn=this.special_remain>0?0:1},n.prototype.onActivate=function(){return!0},n}(dt),It={name:"small hitbox",init:function(){return new Et}},Tt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),Pt={render_layer:500,collide_group:3,collide_mask:3,init_stall:0,exit_margin:0,kill_on_exit:!0,kill_by:function(t){return 4==t||0==t},auto_direction:!0,life:0,listener:null},St=function(t,n){return!0},Nt=function(t){function n(n,e){var i=t.call(this,n)||this;return i.state=0,i.motion=St,i.custom_fields={},i.config=e,i.time=0,i}return Tt(n,t),n.prototype.setMotion=function(t){return this.motion=t,this.simpleInit(0,0,0,0)},n.prototype.simpleInit=function(t,n,e,i){return this.px=t,this.py=n,this.vx=e*Math.cos(i),this.vy=e*Math.sin(i),this.dir=i,this.motion(this,0)&&this.config.auto_direction&&(this.dir=Math.atan2(this.vy,this.vx)),this},n.prototype.init=function(t){return t(this),this},n.prototype.update=function(t){var n,e,i,r,o,a,s,u,c=this;0==this.state&&(this.state=1,null===(e=null===(n=this.config.listener)||void 0===n?void 0:n.onInit)||void 0===e||e.forEach((function(t){return t(c)})));var h=X.INSTANCE.special_effects.time_rate;this.time+=h,null===(r=null===(i=this.config.listener)||void 0===i?void 0:i.onUpdate)||void 0===r||r.forEach((function(t){return t(c,h)})),this.motion(this,h)&&(this.time>this.config.init_stall&&(this.px+=this.vx*h,this.py+=this.vy*h),this.config.auto_direction&&(this.dir=Math.atan2(this.vy,this.vx))),(null===(a=null===(o=this.shaped_sprite)||void 0===o?void 0:o.sprite)||void 0===a?void 0:a.omega)&&(this.dir=this.time*this.shaped_sprite.sprite.omega),null===(u=null===(s=this.config.listener)||void 0===s?void 0:s.onPostMotion)||void 0===u||u.forEach((function(t){return t(c,h)}))},n.prototype.postUpdate=function(t){var n,e,i,r,o,a,s,u,c=this,h=(null===(e=null===(n=this.shaped_sprite)||void 0===n?void 0:n.shape)||void 0===e?void 0:e.exitScreen(this))+this.config.exit_margin,p=this.px>v+h,l=-this.px>v+h,f=this.py>m+h,d=-this.py>m+h;this.motion||(p&&(p=this.vx>0),l&&(l=this.vx<0),f&&(f=this.vy>0),d&&(d=this.vy<0)),(p||l||f||d)&&this.config.kill_on_exit&&(this.state=2,null===(r=null===(i=this.config.listener)||void 0===i?void 0:i.onExitScreen)||void 0===r||r.forEach((function(t){return t(c)}))),this.config.life&&this.time>=this.config.life&&(this.state=2),null===(a=null===(o=this.config.listener)||void 0===o?void 0:o.onPostUpdate)||void 0===a||a.forEach((function(t){return t(c)})),2==this.state&&(null===(u=null===(s=this.config.listener)||void 0===s?void 0:s.onDestroy)||void 0===u||u.forEach((function(t){return t(c)})),this.state=3)},n.prototype.attack=function(t,n){var e,i,r=this;null===(i=null===(e=this.config.listener)||void 0===e?void 0:e.onAttack)||void 0===i||i.forEach((function(t){return t(r,n)})),n.damaged(n,this)},n.prototype.damaged=function(t,n){var e,i,r=this;return!!this.config.kill_by(n.config.collide_group)&&(this.state=2,null===(i=null===(e=this.config.listener)||void 0===e?void 0:e.onKill)||void 0===i||i.forEach((function(t){return t(r,n)})),!0)},n}(d),Rt=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),kt=function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var i=Array(t),r=0;for(n=0;n<e;n++)for(var o=arguments[n],a=0,s=o.length;a<s;a++,r++)i[r]=o[a];return i},Ot=function(){},Ct=function(t){function n(n){var e=t.call(this)||this;return e.remain=n,e}return Rt(n,t),n.prototype.update=function(t){return this.remain-=t,this.remain<0?-this.remain:0},n}(Ot),Ut=function(t){function n(n){var e=t.call(this)||this;return e.time=0,e.init=n,e}return Rt(n,t),n.random=function(t,e){return function(){return new n((function(n){var i=Math.max(e.px0-t.px,-e.dx1),r=Math.min(e.px1-t.px,e.dx1),o=Math.max(e.py0-t.py,-e.dy1),a=Math.min(e.py1-t.py,e.dy1),s=i+Math.random()*(r-i),u=o+Math.random()*(a-o);n.target=t,n.duration=e.duration,n.dx=s,n.dy=u,n.x0=t.px,n.y0=t.py,n.ease=e.ease}))}},n.prototype.update=function(t){0==this.time&&this.init(this),this.time+=t;var n=Math.min(1,this.time/this.duration),e=this.ease(n);return this.target.px=this.x0+this.dx*e,this.target.py=this.y0+this.dy*e,this.time>this.duration?this.time-this.duration:0},n}(Ot),Ft=function(t){function n(n){var e=t.call(this)||this;return e.todo=n,e}return Rt(n,t),n.prototype.update=function(t,n){var e=this.todo();return void 0===e?t:"number"==typeof e?(n.list[0]=new Ct(e),n.list[0].update(t,n)):(n.list.unshift(n.list[0]),n.list[1]=e,t)},n}(Ot),Dt=function(){};function jt(t){return t.map((function(t){return"number"==typeof t?new Ct(t):"function"==typeof t?new Ft(t):t}))}var Bt,Lt,zt=function(t){function n(n,e){var i=t.call(this)||this;return i.index=0,i.todo=n,i.total=e,i}return Rt(n,t),n.prototype.supply=function(){return this.index>=this.total?null:(t="function"==typeof this.todo?this.todo(this.index):this.todo,this.index++,jt(t));var t},n}(Dt),qt={render_layer:0,collide_group:5,collide_mask:0},Xt=function(t){function n(n){var e=t.call(this)||this;return e.custom_fields={},e.config=qt,e.state=0,e.time=0,e.list=jt("object"==typeof n?n:n(e)),e}return Rt(n,t),n.prototype.init=function(t){return t(this),this},n.prototype.update=function(t){0==this.state&&(this.state=1);var n=X.INSTANCE.special_effects.time_rate;for(this.time+=n;this.list.length>0&&n;){var e=this.list[0];if(e instanceof Dt){var i=e.supply();i&&i.length?this.list=kt(i,this.list):this.list.shift()}else(n=e.update(n,this))>0&&this.list.shift()}0==this.list.length&&(this.state=2)},n.prototype.postUpdate=function(t){2==this.state&&(this.state=3)},n.prototype.attack=function(t){},n.prototype.damaged=function(t,n){return!1},n}(y),Yt=function(t,n){return void 0===n&&(n=1/0),function(){return new zt(t,n)}},Gt=function(t){return function(){return X.INSTANCE.add(new Xt(t))}},Ht={name:"波与粒的境界",default_scale:3,init:function(t){var n=ct(et(5,1,0),1);return new Xt([30*t,Yt((function(e){return[Yt((function(i){return[function(){return X.INSTANCE.add(new Nt(n,Pt).simpleInit(0,0,8/t,.003/t*e*e+2*Math.PI/5*i))}]}),5),1*t]}),1/0)])}},Vt={name:"龙纹弹",default_scale:3,init:function(t){var n=function(t){return ct(nt(1,t,0),1)},e=L(Pt);e.life=180*t,e.kill_on_exit=!1;var i={duration:100*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},r=1*t,o=3/t,a=-o/70,s=.06/t,u=new Nt(ct(ot,2),Pt).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),c=null,h=function(t,n,i,h){return X.INSTANCE.add(new Xt([Yt((function(p){return[function(){return X.INSTANCE.add(c=new Nt(null,e).simpleInit(u.px,u.py,o,2*Math.PI/47*p*n*t))},Yt((function(n){return[function(){return X.INSTANCE.add(new Nt(p%2==0?i:h,Pt).setMotion((e=c,r=2*Math.PI/30*n,o=s*t,70,u=a,function(t,n){var i=r+o*t.time,a=70*Math.sin(u*t.time);return t.px=e.px+a*Math.cos(i),t.py=e.py+a*Math.sin(i),t.dir=Math.atan2(a*o,70*u*Math.cos(u*t.time))+i,!1})));var e,r,o,u}]}),30),r]}),47)]))};return new Xt([function(){return X.INSTANCE.add(u)},30*t,Yt((function(e){return[function(){return h(e%2*2-1,7,n(2),n(10))},50*t,function(){return h(e%2*2-1,5,n(13),n(6))},50*t,function(){return h(e%2*2-1,1,n(8),n(4))},Ut.random(u,i)]}))])}},Wt={name:"rotating long bullet",default_scale:3,init:function(t){var n,e=(64,{sprite:n=nt(4,2,0),shape:new p(64,ut(at[1][4])*st),renderType:0,w:n.tw*st,h:80}),i=L(Pt);i.auto_direction=!1;var r={duration:50*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},o=new Nt(ct(ot,2),Pt).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),a=function(t){return Yt((function(n){return[function(){return X.INSTANCE.add(new Nt(e,i).setMotion((function(n,e){return n.dir+=e*t,!0})).simpleInit(o.px,o.py,h,l+2*Math.PI/s*n).init((function(t){return t.dir+=2*Math.PI*u/s*n})))}]}),s)},s=50,u=2.5,c=2*Math.PI/60/t,h=6/t,l=0;return new Xt([function(){return X.INSTANCE.add(o)},30*t,Yt((function(n){return[function(){return l=Math.random()*Math.PI*2},a(c),20*t,a(-c),Ut.random(o,r)]}))])}},Kt={w0:-192,w1:v,h0:-224,h1:m,max:1/0,inner_bound:!0,outer_bound:!1},$t=function(t){return function(n){n.onInit.push((function(n){var e=n.custom_fields;e.in_screen=n.px>t.w0&&n.px<t.w1&&n.py>t.h0&&n.py<t.h1,e.ref_count=0})),n.onPostMotion.push((function(n,e){var i=n.custom_fields,r=i.in_screen;i.in_screen=n.px>t.w0&&n.px<t.w1&&n.py>t.h0&&n.py<t.h1,r&&!i.in_screen&&t.inner_bound&&(i.ref_count<t.max&&n.px<=t.w0&&(i.ref_count++,n.vx=-n.vx,n.px=2*t.w0-n.px),i.ref_count<t.max&&n.px>=t.w1&&(i.ref_count++,n.vx=-n.vx,n.px=2*t.w1-n.px),i.ref_count<t.max&&n.py<=t.h0&&(i.ref_count++,n.vy=-n.vy,n.py=2*t.h0-n.py),i.ref_count<t.max&&n.py>=t.h1&&(i.ref_count++,n.vy=-n.vy,n.py=2*t.h1-n.py),n.dir=Math.atan2(n.vy,n.vx),i.in_screen=!0),!r&&i.in_screen&&t.outer_bound&&(i.ref_count<t.max&&n.px>=t.w0&&(i.ref_count++,n.vx=-n.vx,n.px=2*t.w0-n.px),i.ref_count<t.max&&n.px<=t.w1&&(i.ref_count++,n.vx=-n.vx,n.px=2*t.w1-n.px),i.ref_count<t.max&&n.py>=t.h0&&(i.ref_count++,n.vy=-n.vy,n.py=2*t.h0-n.py),i.ref_count<t.max&&n.py<=t.h1&&(i.ref_count++,n.vy=-n.vy,n.py=2*t.h1-n.py),n.dir=Math.atan2(n.vy,n.vx),i.in_screen=!1)}))}},Jt={name:"",w0:-192,w1:v,h0:-224,h1:m,max:1/0,maxlen:NaN,v:NaN,body:null,cf:null},Qt={name:"reflect and delayed altering",default_scale:3,init:function(t){var n=ct(nt(4,2,0),1),e=L(Pt);e.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]};var i=L(Kt);i.max=100,$t(i)(e.listener);var r=Math.PI/24,o=6/t,a=100*t,s=1*t,u=1*t,c={duration:a-40*u-20*s,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},h=new Nt(ct(ot,2),Pt).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),p=0;return new Xt([function(){return X.INSTANCE.add(h)},30*t,Yt((function(t){return[function(){return p=Math.random()*Math.PI*2},Yt((function(t){return[Gt([Yt((function(){return[function(){return X.INSTANCE.add(new Nt(n,e).setMotion((function(n,e){var s,c=a-t*u;return n.time-e<c&&n.time>=c&&((s=i,function(t){return t.custom_fields.ref_count=s.max})(n),n.simpleInit(n.px,n.py,o,n.dir+(2*Math.random()-1)*r)),!0})).simpleInit(h.px,h.py,o,p+2*Math.PI/40*t))},s]}),20)]),u]}),40),20*s,Ut.random(h,c)]}))])}},Zt={name:"finite reflect",default_scale:3,init:function(t){var n=[ct(nt(4,2,0),1),ct(nt(4,6,0),1)],e=L(Pt),i=L(Pt);e.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]},i.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]};var r=L(Kt),o=L(Kt);r.max=2,r.h0=-1/0,o.max=1,o.h0=-1/0,$t(r)(e.listener),$t(o)(i.listener);var a=6/t,s=1*t,u=3*t,c={duration:40*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},h=new Nt(ct(ot,2),Pt).setMotion((function(t){return t.dir=t.time*Math.PI*2/600,!1})).simpleInit(0,64,0,0),p=0,l=function(t,n,e,i){return Yt((function(r){return[Gt([Yt((function(o){return[Yt((function(s){return[function(){return X.INSTANCE.add(new Nt(t,i).simpleInit(h.px,h.py,a,p+e*Math.PI*2*(r/8/4+s/4+o/4/8/n*.5)))}]}),8),s]}),n)]),u]}),8)};return new Xt([function(){return X.INSTANCE.add(h)},30*t,Yt((function(t){return[function(){return p=Math.random()*Math.PI*2},l(n[0],10,1,e),10*s,Ut.random(h,c),l(n[1],15,-1,i),20*s,Ut.random(h,c)]}))])}},tn={name:"reflect laser",default_scale:3,init:function(t){var n=function(n,e){var i=ht(4,n,e,1,1,1,.75),r={render_layer:Pt.render_layer,collide_group:Pt.collide_group,collide_mask:Pt.collide_mask,warning_time:0,open_time:0,alive_time:1/0,close_time:0,listener:null},o=L(r);r.listener={onInit:[],onUpdate:[],onPostMotion:[],onStateChange:[],onPostUpdate:[],onAttack:[],onContact:[],onDestroy:[]};var a,s=L(Jt);return s.max=2,s.v=8/t,s.maxlen=128,s.body=i,s.cf=o,s.name=n+"-"+e,(a=s,function(t){var n=function(t,n){var e=t.custom_fields;if(e.togrow>0){var i=Math.min(e.togrow,a.v*n);n-=i/a.v,t.len+=i,e.togrow-=i}n>0&&(t.px+=n*e.vx,t.py+=n*e.vy),t.shaped_sprite.end.shape.rawExitScreen(t.px+t.len*Math.cos(t.dir),t.py+t.len*Math.sin(t.dir),t.shaped_sprite.base,v,m)&&t.shaped_sprite.base.shape.rawExitScreen(t.px,t.py,t.shaped_sprite.base,v,m)&&(t.state=3)},e=function(t,n){return t>a.w0&&t<a.w1&&n>a.h0&&n<a.h1},i=function(t,n){var e=t.custom_fields;if(e.toshrink>0){var i=Math.min(e.toshrink,a.v*n);t.len-=i,e.toshrink-=i,e.toshrink<=0&&(t.state=3)}e.togrow>0&&(n-=(i=Math.min(e.togrow,a.v*n))/a.v,t.len+=i,e.togrow-=i),n>0&&(t.px+=n*e.vx,t.py+=n*e.vy),t.shaped_sprite.base.shape.rawExitScreen(t.px,t.py,t.shaped_sprite.base,v,m)&&(t.state=3)};t.onInit.push((function(t){var e=t.custom_fields;e.ref_count=0,e.vx=a.v*Math.cos(t.dir),e.vy=a.v*Math.sin(t.dir),e.togrow=a.maxlen,e.toshrink=0,t.motion=n})),t.onPostMotion.push((function(t,n){var r=t.custom_fields,o=(e(t.px,t.py),t.px+t.len*Math.cos(t.dir)),s=t.py+t.len*Math.sin(t.dir);if(!e(o,s)&&r.ref_count<a.max){var u=new K(a.body,a.cf,i);u.init(t.px,t.py,t.dir,t.len);var c=u.custom_fields;c.vx=r.vx,c.vy=r.vy,c.togrow=r.togrow,X.INSTANCE.add(u);var h=0,p=0;r.ref_count<a.max&&o<=a.w0&&(h=a.w0,p=t.py+(a.w0-t.px)*r.vy/r.vx,r.ref_count++,r.vx=-r.vx,t.px=2*a.w0-t.px),r.ref_count<a.max&&o>=a.w1&&(h=a.w1,p=t.py+(a.w1-t.px)*r.vy/r.vx,r.ref_count++,r.vx=-r.vx,t.px=2*a.w1-t.px),r.ref_count<a.max&&s<=a.h0&&(p=a.h0,h=t.px+(a.h0-t.py)*r.vx/r.vy,r.ref_count++,r.vy=-r.vy,t.py=2*a.h0-t.py),r.ref_count<a.max&&s>=a.h1&&(p=a.h1,h=t.px+(a.h1-t.py)*r.vx/r.vy,r.ref_count++,r.vy=-r.vy,t.py=2*a.h1-t.py);var l=Math.sqrt(Math.pow(t.px-h,2)+Math.pow(t.py-p,2));t.len-=l,t.px=h,t.py=p,r.togrow+=l,u.len=l,c.toshrink=l+c.togrow,t.dir=Math.atan2(r.vy,r.vx)}}))})(r.listener),[i,r,s]},e=[n(6,3),n(2,1)],i=2*Math.PI/t,r=t,o=function(t,n,i,r,o,a){return Yt((function(t){return[Yt((function(o){return[function(){return X.INSTANCE.add(new K(e[n][0],e[n][1],null).init(0,0,a+2*Math.PI/i*o+r*t,0))}]}),i),o]}),t)};return new Xt([30*t,Yt((function(n){return[o(20,0,3,(n%2*2-1)*i*.0678,6*r,2*Math.random()*Math.PI),100*t,o(120,1,1,(n%2*2-1)*i*.0234,r,2*Math.random()*Math.PI),100*t]}))])}},nn={name:"Test Special Effect",default_scale:1,init:function(t){var n=ct(nt(1,2,0),1),e=ct(nt(1,1,0),1),i=ct(it(0,0,1),1),r=Pt,o=L(Pt);o.life=160*t,o.kill_on_exit=!1,o.kill_by=function(){return!1};var a=6/t,s=.4*a,u=2*t,c=6*t,h=Math.PI/3;return new Xt([30*t,Yt((function(p){return[function(){return X.INSTANCE.special_effects.time_slowdown(1/4,4*(8*c+160/a))},(l=p%2*2-1,f=h,void 0===d&&(d=Math.PI/2),Yt((function(t){return[Gt((function(c,h){return void 0===h&&(h=c.custom_fields),[function(){h.a1=d+2*Math.PI*t/8*l;var n=h.a1+Math.PI/2*l;X.INSTANCE.add(h.host=new Nt(i,o).simpleInit(160*Math.cos(h.a1)-240*Math.cos(n),160*Math.sin(h.a1)-240*Math.sin(n),a,n))},Gt([Yt((function(){return[Yt((function(t){return[Yt((function(n){return[function(){return X.INSTANCE.add(new Nt(e,r).simpleInit(h.host.px,h.host.py,s*(2+t)/4,h.a1+(n-1)*Math.PI/3))}]}),3)]}),3),u]}),Math.round(480/a/u))]),Math.round(80/a),function(){h.plx=H.INSTANCE.px,h.ply=H.INSTANCE.py},Yt((function(){return[function(){h.dir=Math.atan2(h.ply-h.host.py,h.plx-h.host.px)},Yt((function(t){return[Yt((function(e){return[function(){return X.INSTANCE.add(new Nt(n,r).simpleInit(h.host.px,h.host.py,s*(2+t)/4,h.dir+(e-1)*f))}]}),3)]}),3),u]}),Math.round(320/a/u))]})),c]}),8)),240*t];var l,f,d}))])}},en={name:"RayLaser Hitbox Test",default_scale:3,init:function(t){var n=function(t,n,e){return ht(t,2,1,1,n,e,1)},e=[n(0,0,0),n(0,1,1),n(0,0,1),n(0,1,0),n(4,0,0),n(4,1,1),n(4,0,1),n(4,1,0),n(1,0,0),n(1,1,0)],i={render_layer:Pt.render_layer,collide_group:Pt.collide_group,collide_mask:Pt.collide_mask,warning_time:30*t,open_time:10*t,alive_time:6e3*t,close_time:10*t,listener:null},r=0*Math.PI*2/240/t;return new Xt([30*t,Yt((function(n){return[Yt((function(t){return[function(){return X.INSTANCE.add(new K(e[t],i,(o=r*(n%2*2-1),function(t,n){return t.dir+=n*o})).init(50*Math.cos(2*Math.PI/10*t),50*Math.sin(2*Math.PI/10*t),2*Math.PI/10*t,100));var o}]}),10),6e3*t]}))])}},rn={name:"Local Variable Test",default_scale:1,init:function(t){var n=L(Pt);n.listener={onInit:[],onUpdate:[],onPostMotion:[],onPostUpdate:[],onAttack:[],onDestroy:[],onExitScreen:[],onKill:[]},n.listener.onAttack.push((function(t){return t.custom_fields.callback()}));var e=[[ct(nt(3,6,0),1),ct(it(0,1,1),1)],[ct(nt(3,2,0),1),ct(it(0,0,1),1)],[ct(nt(3,13,0),1),ct(it(0,3,1),1)],[ct(nt(3,10,0),1),ct(it(0,2,1),1)]],i={duration:40*t,px0:-96,px1:96,py0:32,py1:112,dx1:64,dy1:64,ease:function(t){return(1-Math.cos(Math.PI*t))/2}},r=2.5/t;return new Xt([60*t,Yt((function(o){return[Gt((a=o,function(t,o){return void 0===o&&(o=t.custom_fields),[function(){var t=Math.random()*Math.PI*2;o.px=50*Math.cos(t),o.py=64+50*Math.sin(t),o.count=0},Yt([Yt((function(t){return[function(){return X.INSTANCE.add(new Nt(0==o.count?e[a][0]:e[a][1],n).simpleInit(o.px,o.py,r,2*Math.PI/40*t).init((function(t,n){void 0===n&&(n=t.custom_fields),n.callback=function(){return o.count++}})))}]}),40),function(){return o.count=0},Ut.random(o,i)])]})),150*t];var a}),4)])}},on=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),an=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}on(n,t),n.prototype.distanceTo=function(t,n,e){var i=this;return t.getStat().list.reduce((function(r,o){return Math.min(r,i._distanceTo(t,o.start,o.len,n,e))}),1/0)}}(u),function(t){on((function(){return null!==t&&t.apply(this,arguments)||this}),t)}(l),function(){function t(){this.exist=!1,this.list=[],this.start=-1,this.count=0}return t.prototype.reduce=function(t,n){return t&&1==t.state?(this.exist||(this.start=n),this.exist=!0,this.count++):this.exist&&(this.exist=!1,this.list.push({start:this.start,len:this.count}),this.count=0),this},t}()),sn=function(t){function n(n){var e=t.call(this,1,n)||this;return e.list=[],e}return on(n,t),n.prototype.getStat=function(){return this.list.reduce((function(t,n,e){return t.reduce(n,e)}),new an).reduce(null,0)},n.prototype.preRender=function(){return{curve:this,list:this.getStat().list}},n.prototype.getSprite=function(){return this.shaped_sprite},n}(f),un=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){function i(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),cn={collide_group:5,collide_mask:0,render_layer:500,kill_on_empty:!0,protect:0,life:0},hn=function(t){function n(n,e){var i=t.call(this,n)||this;return i.state=0,i.time=0,i.config=e,i}return un(n,t),n.prototype.add=function(t){return this.list.push(t),t},n.prototype.update=function(t){0==this.state&&(this.state=1);var n=X.INSTANCE.special_effects.time_rate;this.time+=n;for(var e=0,i=this.getStat().list;e<i.length;e++)for(var r=i[e],o=0;o<r.len;o++)this.list[o+r.start].magn=this.shaped_sprite.radius(r.start,r.len,o)},n.prototype.attack=function(t,n){},n.prototype.postUpdate=function(t){for(;this.list.length&&3==this.list[0].state;)this.list.shift();this.time>this.config.protect&&this.config.kill_on_empty&&!this.list.length&&(this.state=3)},n.prototype.damaged=function(t,n){return!1},n.prototype.distanceTo=function(t,n){return 1/0},n}(sn),pn={name:"curve test",default_scale:1,init:function(t){var n,e,i=ct(nt(9,2,0),1),r=(null,{sprite:n=nt(14,2,1),shape:null,renderType:1,w:e=ut(at[1][14])*st,sp_w:n.th*st,radius:function(t,n,i){if(n<=2||i/(n-1)*16<.5||i/(n-1)*16>15.5)return-1/0;var r=((i+.5)/n-.5)*e*16,o=255*e/2;return(Math.sqrt(Math.pow(o+e,2)-Math.pow(r,2))-o)/e}}),o=L(Pt),a=L(cn);o.init_stall=5*t,o.exit_margin=50,i.sprite=null;var s,u=2/t,c=2*Math.PI/4,h=2*Math.PI/180/t;return new Xt([60*t,Yt((function(n){return[function(){s=2*Math.PI*Math.random()},Yt((function(n){return[Gt((function(e,p){return void 0===p&&(p=e.custom_fields),[function(){p.curve=new hn(r,a),X.INSTANCE.add(p.curve),p.a0=s+2*Math.PI/32*5*n},Yt((function(n){return[function(){var t=new Nt(i,o);t.setMotion(function(t,n,e){return function(i,r){var o=t+n*Math.sin(i.time*e);return i.vx=u*Math.cos(o),i.vy=u*Math.sin(o),!0}}(p.a0,c,h)),t.simpleInit(0,0,u,p.a0),p.curve.add(t),X.INSTANCE.add(t)},5*t]}),32)]})),4*t]}),32),240*t]}))])}},ln=Object.values(n),fn=Object.values(i),dn=!1,yn=!1,_n=0,vn=0,mn=0,wn=0;var gn,xn,bn=0,Mn=0,An=null,En=1,In=1;function Tn(){return bn=performance.now(),Mn=241,Pn(),new Promise(((t,n)=>{An=t}))}function Pn(){if(--Mn)requestAnimationFrame(Pn);else{var t=(performance.now()-bn)/240;In=Math.round(t/(1e3/60)),An(In)}}var Sn={x:0,y:0},Nn={};function Rn(){document.onmousemove=t=>{Sn.x=t.pageX,Sn.y=t.pageY},document.ontouchstart=t=>{Nn._touch=3,Sn.x=t.pageX,Sn.y=t.pageY,t.preventDefault()},document.ontouchend=t=>{Nn._touch=1,Sn.x=t.pageX,Sn.y=t.pageY,t.preventDefault()},document.ontouchmove=t=>{Sn.x=t.pageX,Sn.y=t.pageY,t.preventDefault()},document.onmousedown=t=>{Nn._press=3},document.onmouseup=t=>{Nn._press=1},document.addEventListener("keydown",(t=>{var n=t.key;1==n.length&&(n=n.toLowerCase()),Nn[n]=3}),!1),document.addEventListener("keyup",(t=>{var n=t.key;1==n.length&&(n=n.toLowerCase()),Nn[n]=1}),!1);var t=window.innerWidth,n=window.innerHeight,e=.95*Math.min(t/w,n/g),i=document.getElementById("glcanvas");gn=e*w,xn=e*g,i.style.width=gn+"px",i.style.height=xn+"px",En=window.devicePixelRatio||1,i.width=gn*En,i.height=xn*En,E()}var kn,On,Cn=!1;async function Un(){Cn||(Cn=!0,await function(){return n=this,e=void 0,r=function(){var n,e,i,r;return function(t,n){var e,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(t,a)}catch(t){o=[6,t],i=0}finally{e=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(o){switch(o.label){case 0:return e=(n=t).loadTexture,[4,T("assets/ui_bg.png")];case 1:return Bt=e.apply(n,[o.sent(),!1,!0]),r=(i=t).loadTexture,[4,T("assets/scene_bg.png")];case 2:return Lt=r.apply(i,[o.sent(),!1,!0]),[2]}}))},new((i=void 0)||(i=Promise))((function(t,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(n){var e;n.done?t(n.value):(e=n.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,s)}u((r=r.apply(n,e||[])).next())}));var n,e,i,r}(),Dn())}function Fn(){Cn=!1}function Dn(){(kn=performance.now())-On>33&&console.log(`Violation: interval takes ${Math.round(100*(kn-On))/100} ms`),function(){var t=X.INSTANCE;if(t){var n=function(){if(Nn.Escape==Bn&&(dn=!dn),dn)return yn=!1,null;var t=0,n=0;Nn.Shift>=jn||Nn._touch>=jn||Nn._press>=jn?(yn||(yn=!0,_n=Sn.x,vn=Sn.y,mn=0,wn=0),t=Sn.x-_n-mn,n=Sn.y-vn-wn,mn+=t,wn+=n):yn=!1,t=t/gn*w*2,n=-n/xn*g*2;var e=Nn.Shift>=jn?2:3;return(Nn.w>=jn||Nn.ArrowUp>=jn)&&(n+=e),(Nn.s>=jn||Nn.ArrowDown>=jn)&&(n-=e),(Nn.a>=jn||Nn.ArrowLeft>=jn)&&(t-=e),(Nn.d>=jn||Nn.ArrowRight>=jn)&&(t+=e),{pos_x:t,pos_y:n,key_z:Nn.z>=jn,key_x:Nn.x==Bn,key_c:Nn.c==Bn}}();if(!dn&&(H.updateState(n),!dn))for(var e=0;e<In;e++)t.update();N();var i=new pt;i.bind(Lt),function(t){t.rect([-192,-224,384,448],M)}(i),i.flush(),t.render(),I(0),i.bind(Bt),function(t){var n=function(n){return t.rect(n,M)};n([-192,224,384,16]),n([-192,-240,384,16]),n([-360,-240,168,480]),n([v,-240,168,480])}(i),i.flush()}}(),function(){for(var t in Nn)3==Nn[t]&&(Nn[t]=2),1==Nn[t]&&(Nn[t]=0)}(),Cn&&requestAnimationFrame(Dn),(On=performance.now())-kn>16&&console.log(`Violation: loop takes ${Math.round(100*(On-kn))/100} ms`)}const jn=2,Bn=3,Ln=window;var zn={radius:1,pre_miss:30,miss_time:60,graze_radius:24,max_graze:600,init_bomb:3,init_life:3,init_ability:5,max_bomb:10,max_life:10,max_ability:5},qn={init:Xn,stage:6,scale:1,ability:1,stage_list:fn,ability_list:ln};function Xn(){return t=this,n=void 0,i=function(){var t;return function(t,n){var e,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;a;)try{if(e=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=n.call(t,a)}catch(t){o=[6,t],i=0}finally{e=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(n){switch(n.label){case 0:return[4,B.get(Z.path).load()];case 1:return n.sent(),Ln.debug_info.load_sprites(),(t=new X).add(new H(ct(rt,1),new G(null,null,ln[qn.ability].init()),zn,0,-192)),t.add(fn[qn.stage].init(qn.scale)),Ln.debug_info.pool=t,Ln.debug_info.stage=qn,[2]}}))},new((e=void 0)||(e=Promise))((function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(a,s)}u((i=i.apply(t,n||[])).next())}));var t,n,e,i}window.onload=async function(){Rn(),window.debug_info.load_sprites=()=>{document.getElementById("loading").hidden=!0},await Xn(),e(235),Un(),window.debug_info.stg={fps:Tn,init:Xn,start:Un,terminate:Fn},window.debug_info.platform=r},window.debug_info={}})()})();